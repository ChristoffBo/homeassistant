#!/usr/bin/with-contenv bash

[ ! -f "/data/options.json" ] && {
    echo "ERROR: Missing configuration file"
    exit 1
}

export REPO_SOURCE=$(jq -r '.repo_source' /data/options.json)
export ENABLE_GOTIFY=$(jq -r '.enable_gotify' /data/options.json)
export GOTIFY_URL=$(jq -r '.gotify_url' /data/options.json)
export GOTIFY_TOKEN=$(jq -r '.gotify_token' /data/options.json)
export GITEA_API_URL=$(jq -r '.gitea_api_url' /data/options.json)
export GITEA_TOKEN=$(jq -r '.gitea_token' /data/options.json)

[ "$REPO_SOURCE" = "gitea" ] && {
    [ -z "$GITEA_API_URL" ] && { echo "ERROR: gitea_api_url required"; exit 1; }
    [ -z "$GITEA_TOKEN" ] && { echo "ERROR: gitea_token required"; exit 1; }
}

[ "$ENABLE_GOTIFY" = "true" ] && {
    [ -z "$GOTIFY_URL" ] && { echo "ERROR: gotify_url required"; exit 1; }
    [ -z "$GOTIFY_TOKEN" ] && { echo "ERROR: gotify_token required"; exit 1; }
}
