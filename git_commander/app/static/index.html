<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Commander</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body { transition: background-color 0.3s, color 0.3s; }
        .dark { background-color: #1a202c; color: #e2e8f0; }
        .dark .bg-gray-100 { background-color: #2d3748; }
        .dark .text-gray-900 { color: #e2e8f0; }
        .tab { display: none; }
        .tab.active { display: block; }
    </style>
</head>
<body class="min-h-screen bg-gray-100 text-gray-900 dark:bg-gray-900 dark:text-white">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl font-bold mb-4">Git Commander</h1>
        <button id="themeToggle" class="mb-4 px-4 py-2 bg-blue-500 text-white rounded">Toggle Dark Mode</button>
        
        <!-- Tabs -->
        <div class="tabs flex space-x-4 mb-4">
            <button class="tab-button active px-4 py-2 bg-blue-500 text-white rounded" data-tab="upload">Upload</button>
            <button class="tab-button px-4 py-2 bg-gray-300 rounded" data-tab="git">Git Commands</button>
            <button class="tab-button px-4 py-2 bg-gray-300 rounded" data-tab="backup">Backup</button>
            <button class="tab-button px-4 py-2 bg-gray-300 rounded" data-tab="restore">Restore</button>
            <button class="tab-button px-4 py-2 bg-gray-300 rounded" data-tab="config">Config</button>
        </div>

        <!-- Upload Tab -->
        <div id="upload" class="tab active">
            <h2 class="text-xl font-semibold mb-2">Upload ZIP File</h2>
            <input type="file" id="zipFile" accept=".zip" class="mb-2">
            <button id="uploadBtn" class="px-4 py-2 bg-blue-500 text-white rounded">Upload</button>
            <p id="uploadMessage" class="mt-2"></p>
        </div>

        <!-- Git Commands Tab -->
        <div id="git" class="tab">
            <h2 class="text-xl font-semibold mb-2">Git Commands</h2>
            <div class="space-y-2">
                <button class="git-btn px-4 py-2 bg-blue-500 text-white rounded" data-command="pull">Pull</button>
                <button class="git-btn px-4 py-2 bg-blue-500 text-white rounded" data-command="status">Status</button>
                <button class="git-btn px-4 py-2 bg-blue-500 text-white rounded" data-command="reset">Reset</button>
                <button class="git-btn px-4 py-2 bg-blue-500 text-white rounded" data-command="stash">Stash</button>
                <button class="git-btn px-4 py-2 bg-blue-500 text-white rounded" data-command="commit">Commit</button>
            </div>
            <pre id="gitOutput" class="mt-2 p-2 bg-gray-200 dark:bg-gray-800 rounded"></pre>
        </div>

        <!-- Backup Tab -->
        <div id="backup" class="tab">
            <h2 class="text-xl font-semibold mb-2">Backup Repository</h2>
            <button id="backupBtn" class="px-4 py-2 bg-blue-500 text-white rounded">Create Backup</button>
            <p id="backupMessage" class="mt-2"></p>
        </div>

        <!-- Restore Tab -->
        <div id="restore" class="tab">
            <h2 class="text-xl font-semibold mb-2">Restore Repository</h2>
            <input type="file" id="restoreFile" accept=".zip" class="mb-2">
            <button id="restoreBtn" class="px-4 py-2 bg-blue-500 text-white rounded">Restore</button>
            <p id="restoreMessage" class="mt-2"></p>
        </div>

        <!-- Config Tab -->
        <div id="config" class="tab">
            <h2 class="text-xl font-semibold mb-2">Configuration</h2>
            <form id="configForm" class="space-y-2">
                <div>
                    <label class="block">GitHub URL:</label>
                    <input type="text" name="github_url" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">GitHub Token:</label>
                    <input type="text" name="github_token" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">Gitea URL:</label>
                    <input type="text" name="gitea_url" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">Gitea Token:</label>
                    <input type="text" name="gitea_token" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">Repository:</label>
                    <input type="text" name="repository" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">Commit Message:</label>
                    <input type="text" name="commit_message" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">Branch Name:</label>
                    <input type="text" name="branch_name" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">Author Name:</label>
                    <input type="text" name="author_name" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">Author Email:</label>
                    <input type="text" name="author_email" class="w-full p-2 border rounded">
                </div>
                <div>
                    <label class="block">Git Target:</label>
                    <select name="git_target" class="w-full p-2 border rounded">
                        <option value="github">GitHub</option>
                        <option value="gitea">Gitea</option>
                    </select>
                </div>
                <div>
                    <label class="block">Use HTTPS:</label>
                    <input type="checkbox" name="use_https" class="p-2">
                </div>
                <button type="button" id="saveConfigBtn" class="px-4 py-2 bg-blue-500 text-white rounded">Save</button>
            </form>
            <p id="configMessage" class="mt-2"></p>
        </div>
    </div>

    <script>
        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            document.body.classList.toggle('dark');
        });

        // Tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active', 'bg-blue-500', 'text-white'));
                button.classList.add('active', 'bg-blue-500', 'text-white');
                document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
                document.getElementById(button.dataset.tab).classList.add('active');
            });
        });

        // Upload ZIP
        document.getElementById('uploadBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('zipFile');
            const message = document.getElementById('uploadMessage');
            if (!fileInput.files[0]) {
                message.textContent = 'Please select a ZIP file';
                return;
            }
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            const response = await fetch('/api/upload', { method: 'POST', body: formData });
            const result = await response.json();
            message.textContent = result.message || result.error;
        });

        // Git commands
        document.querySelectorAll('.git-btn').forEach(button => {
            button.addEventListener('click', async () => {
                const output = document.getElementById('gitOutput');
                const response = await fetch(`/api/git/${button.dataset.command}`, { method: 'POST' });
                const result = await response.json();
                output.textContent = result.message || result.error;
            });
        });

        // Backup
        document.getElementById('backupBtn').addEventListener('click', async () => {
            const message = document.getElementById('backupMessage');
            const response = await fetch('/api/backup', { method: 'POST' });
            if (response.ok) {
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup_${new Date().toISOString()}.zip`;
                a.click();
                window.URL.revokeObjectURL(url);
                message.textContent = 'Backup created and downloaded';
            } else {
                const result = await response.json();
                message.textContent = result.error;
            }
        });

        // Restore
        document.getElementById('restoreBtn').addEventListener('click', async () => {
            const fileInput = document.getElementById('restoreFile');
            const message = document.getElementById('restoreMessage');
            if (!fileInput.files[0]) {
                message.textContent = 'Please select a ZIP file';
                return;
            }
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            const response = await fetch('/api/restore', { method: 'POST', body: formData });
            const result = await response.json();
            message.textContent = result.message || result.error;
        });

        // Load and save config
        async function loadConfig() {
            const response = await fetch('/api/config');
            const config = await response.json();
            const form = document.getElementById('configForm');
            Object.keys(config).forEach(key => {
                const input = form.querySelector(`[name="${key}"]`);
                if (input) {
                    if (input.type === 'checkbox') {
                        input.checked = config[key];
                    } else {
                        input.value = config[key];
                    }
                }
            });
        }

        document.getElementById('saveConfigBtn').addEventListener('click', async () => {
            const form = document.getElementById('configForm');
            const config = {};
            new FormData(form).forEach((value, key) => {
                config[key] = key === 'use_https' ? (value === 'on') : value;
            });
            const response = await fetch('/api/config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(config)
            });
            const result = await response.json();
            document.getElementById('configMessage').textContent = result.message || result.error;
        });

        // Load config on page load
        loadConfig();
    </script>
</body>
</html>
