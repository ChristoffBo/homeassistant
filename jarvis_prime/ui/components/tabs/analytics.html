<!-- ANALYTICS TAB - Keeping existing content -->
    <section id="analytics" class="tab-panel">
      <div class="panel-header">
        <div class="panel-title">
          <h1>Analytics & Monitoring</h1>
          <div class="panel-subtitle">Real-time homelab health monitoring and uptime tracking</div>
        </div>
      </div>

      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-label">Health Score</div>
          </div>
          <div class="metric-value" id="health-score" style="font-size: 48px;">0%</div>
        </div>
        
        <div class="metric-card green">
          <div class="metric-header">
            <div class="metric-label">Services Up</div>
          </div>
          <div class="metric-value" id="services-up">0</div>
        </div>
        
        <div class="metric-card red">
          <div class="metric-header">
            <div class="metric-label">Services Down</div>
          </div>
          <div class="metric-value" id="services-down">0</div>
        </div>
        
        <div class="metric-card cyan">
          <div class="metric-header">
            <div class="metric-label">Total Monitored</div>
          </div>
          <div class="metric-value" id="services-total">0</div>
        </div>
      </div>

      <div style="margin: 20px 0; display: flex; gap: 12px; flex-wrap: wrap;">
        <button class="btn" onclick="analyticsResetHealth()" 
                style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); color: #f59e0b;">
          Reset Health Scores
        </button>
        <button class="btn" onclick="analyticsResetIncidents()" 
                style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444;">
          Clear All Incidents
        </button>
        
        <button class="btn" onclick="analyticsPurgeWeek()" 
                style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: #8b5cf6;">
          Purge 1 Week
        </button>
        <button class="btn" onclick="analyticsPurgeMonth()" 
                style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: #8b5cf6;">
          Purge 1 Month
        </button>
        <button class="btn" onclick="analyticsPurgeAll()" 
                style="background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.4); color: #ef4444;">
          Purge ALL
        </button>
      </div>

      <div class="orch-tabs">
        <button class="orch-tab active" data-analytics-tab="dashboard">Dashboard</button>
        <button class="orch-tab" data-analytics-tab="services">Services</button>
        <button class="orch-tab" data-analytics-tab="incidents">Incidents</button>
        <button class="orch-tab" data-analytics-tab="network">Network</button>
        <button class="orch-tab" data-analytics-tab="internet">Internet</button>
      </div>

      <div id="analytics-dashboard" class="orch-panel active">
        <div class="panel">
          <div class="panel-head">
            <h3>Service Status Overview</h3>
            <button class="btn primary" onclick="analyticsRefresh()">Refresh</button>
          </div>
          <div id="analytics-services-grid" class="playbooks-grid">
            <div class="text-center text-muted">Loading services...</div>
          </div>
        </div>
      </div>

      <div id="analytics-services" class="orch-panel">
        <div class="panel">
          <div class="panel-head">
            <h3>Monitored Services</h3>
            <button class="btn primary" onclick="analyticsShowAddService()">Add Service</button>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Service Name</th>
                <th>Endpoint</th>
                <th>Type</th>
                <th>Status</th>
                <th>Interval</th>
                <th>Enabled</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="analytics-services-list">
              <tr><td colspan="7" class="text-center text-muted">Loading services...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div id="analytics-incidents" class="orch-panel">
        <div class="panel">
          <div class="panel-head">
            <h3>Recent Incidents (Last 7 Days)</h3>
            <button class="btn primary" onclick="analyticsLoadIncidents()">Refresh</button>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Service</th>
                <th>Time</th>
                <th>Duration</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="analytics-incidents-list">
              <tr><td colspan="4" class="text-center text-muted">Loading incidents...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- NETWORK MONITORING PANEL -->
      <div id="analytics-network" class="orch-panel">
        <!-- Network Stats Cards -->
        <div class="metrics-grid" style="margin-bottom: 24px;">
          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-label">Total Devices</div>
            </div>
            <div class="metric-value" id="net-total-devices">0</div>
          </div>
          
          <div class="metric-card green">
            <div class="metric-header">
              <div class="metric-label">Monitored Devices</div>
            </div>
            <div class="metric-value" id="net-monitored-devices">0</div>
          </div>
          
          <div class="metric-card cyan">
            <div class="metric-header">
              <div class="metric-label">Permanent Devices</div>
            </div>
            <div class="metric-value" id="net-permanent-devices">0</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-label">Scans (24h)</div>
            </div>
            <div class="metric-value" id="net-scans-24h">0</div>
          </div>
        </div>

        <!-- Network Controls -->
        <div style="margin-bottom: 24px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
          <button id="btn-network-scan" class="btn primary" onclick="networkRunScan()">
            üîç Run Network Scan
          </button>
          <button id="btn-toggle-monitoring" class="btn" onclick="networkToggleMonitoringMode()">
            ‚ñ∂Ô∏è Start Monitoring
          </button>
          <div style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: var(--surface-secondary); border-radius: 8px;">
            <input type="checkbox" id="toggle-alert-new-devices" onchange="networkToggleAlerts()" checked />
            <label for="toggle-alert-new-devices" style="margin: 0; cursor: pointer;">Alert on new devices</label>
          </div>
          <div style="margin-left: auto; padding: 8px 16px; background: var(--surface-secondary); border-radius: 8px;">
            Last scan: <span id="net-last-scan">Never</span>
          </div>
        </div>

        <!-- Discovered Devices -->
        <div class="panel">
          <div class="panel-head">
            <h3>Discovered Devices</h3>
            <div style="font-size: 14px; color: var(--text-muted);">
              Click device names to rename ‚Ä¢ Check boxes to monitor
            </div>
          </div>
          <div style="overflow-x: auto;">
            <table class="data-table">
              <thead>
                <tr>
                  <th style="width: 60px;">Online</th>
                  <th>MAC Address</th>
                  <th>Device Name</th>
                  <th>IP Address</th>
                  <th>Vendor</th>
                  <th>Last Seen</th>
                  <th style="width: 120px;">Actions</th>
                </tr>
              </thead>
              <tbody id="network-devices-list">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    No devices found. Run a network scan to discover devices.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Network Events -->
        <div class="panel" style="margin-top: 24px;">
          <div class="panel-head">
            <h3>Network Events (Last 24 Hours)</h3>
          </div>
          <div style="overflow-x: auto;">
            <table class="data-table">
              <thead>
                <tr>
                  <th style="width: 60px;"></th>
                  <th>Event Type</th>
                  <th>MAC Address</th>
                  <th>IP Address</th>
                  <th>Timestamp</th>
                </tr>
              </thead>
              <tbody id="network-events-list">
                <tr>
                  <td colspan="5" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                    No events in the last 24 hours
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- ‚ú® NEW: INTERNET SPEED TEST PANEL -->
      <div id="analytics-internet" class="orch-panel">
        <!-- Speed Test Stats Cards -->
        <div class="metrics-grid" style="margin-bottom: 24px;">
          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-label">Avg Download</div>
            </div>
            <div class="metric-value" id="speed-avg-download">--</div>
          </div>
          
          <div class="metric-card green">
            <div class="metric-header">
              <div class="metric-label">Avg Upload</div>
            </div>
            <div class="metric-value" id="speed-avg-upload">--</div>
          </div>
          
          <div class="metric-card cyan">
            <div class="metric-header">
              <div class="metric-label">Avg Ping</div>
            </div>
            <div class="metric-value" id="speed-avg-ping">--</div>
          </div>
          
          <div class="metric-card">
            <div class="metric-header">
              <div class="metric-label">Total Tests</div>
            </div>
            <div class="metric-value" id="speed-total-tests">0</div>
          </div>
        </div>

        <!-- Speed Test Actions -->
        <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
          <button id="speed-test-btn" class="btn primary" onclick="analyticsRunSpeedTest()">
            üöÄ Run Test Now
          </button>
          <button id="speed-monitoring-toggle" class="btn btn-success" onclick="analyticsToggleSpeedMonitoring()">
            ‚ñ∂Ô∏è Start Auto-Testing
          </button>
          <button class="btn secondary" onclick="analyticsLoadInternetDashboard()">
            üîÑ Refresh
          </button>
        </div>

        <!-- Schedule Configuration -->
        <div class="panel" style="margin-bottom: 2rem;">
          <div class="panel-head">
            <h3>‚è∞ Test Schedule</h3>
          </div>
          <div class="panel-body">
            <!-- Notification Toggle -->
            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; padding: 1rem; background: #2a2a2a; border-radius: 8px;">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; flex: 1;">
                <input 
                  type="checkbox" 
                  id="notify-on-every-test" 
                  checked
                  onchange="analyticsToggleNotifyOnEveryTest()"
                  style="width: 20px; height: 20px; cursor: pointer;"
                />
                <span style="font-weight: 500;">üì¢ Notify on Every Test</span>
              </label>
              <span style="color: #888; font-size: 0.9rem;">When OFF, only get alerts for problems</span>
            </div>

            <!-- Mode Selection -->
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
              <button id="schedule-mode-interval" class="btn active" onclick="analyticsSwitchScheduleMode('interval')" style="flex: 1;">
                ‚è±Ô∏è Interval Mode
              </button>
              <button id="schedule-mode-scheduled" class="btn" onclick="analyticsSwitchScheduleMode('scheduled')" style="flex: 1;">
                üïê Scheduled Times
              </button>
            </div>

            <!-- Interval Controls -->
            <div id="interval-controls" style="display: block;">
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Run every:</label>
              <div style="display: flex; align-items: center; gap: 1rem;">
                <input 
                  type="range" 
                  id="interval-hours" 
                  min="1" 
                  max="24" 
                  value="12" 
                  onchange="analyticsUpdateInterval()"
                  style="flex: 1;"
                />
                <span id="interval-value" style="min-width: 80px; font-weight: 500;">12 hours</span>
              </div>
            </div>

            <!-- Scheduled Times Controls -->
            <div id="scheduled-controls" style="display: none;">
              <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">Add test time:</label>
              <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                <input 
                  type="time" 
                  id="scheduled-time-input" 
                  class="form-input" 
                  style="flex: 1;"
                />
                <button class="btn btn-success" onclick="analyticsAddScheduledTime()">
                  ‚ûï Add
                </button>
              </div>
              
              <div id="scheduled-times-list">
                <p style="color: #888; text-align: center;">No times scheduled</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Latest Result -->
        <div style="margin-bottom: 2rem;">
          <h4>Latest Result</h4>
          <div id="speed-latest-result" style="background: #1a1a1a; padding: 2rem; border-radius: 8px; border: 1px solid #2a2a2a;">
            <p style="text-align: center; color: #888;">No tests yet. Click "Run Test Now"</p>
          </div>
        </div>

        <!-- Test History -->
        <div class="panel">
          <div class="panel-head">
            <h3>Recent Tests (Last 7 Days)</h3>
          </div>
          <div style="overflow-x: auto;">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>Download</th>
                  <th>Upload</th>
                  <th>Ping</th>
                  <th>Status</th>
                  <th>Server</th>
                </tr>
              </thead>
              <tbody id="speed-history-tbody">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 2rem; color: #888;">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>