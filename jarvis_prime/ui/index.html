<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Jarvis Prime Control System</title>
  
  <script>window.JARVIS_API_BASE = window.JARVIS_API_BASE || null;</script>
  
  <script>
    (function () {
      var p = location.pathname;
      if (p.endsWith('/index.html')) p = p.slice(0, -'index.html'.length);
      var dir = p.endsWith('/') ? p : p.replace(/[^\/]*$/, '');
      if (!dir.endsWith('/') && dir !== '') dir += '/';
      document.write('<base href="' + dir + '">');
    })();
  </script>

  <link rel="stylesheet" href="style.css?v=3.0" />
</head>

<body>
  <header class="system-header">
    <div class="header-content">
      <div class="system-brand">
        <div class="brand-icon">ðŸ¤–</div>
        <div class="brand-text">
          <div class="brand-title">Jarvis Prime</div>
          <div class="brand-subtitle">Neural Control System</div>
        </div>
      </div>
      
      <nav class="system-nav">
        <button class="nav-tab active" data-tab="inbox">
          ðŸ“¥ Message Inbox
        </button>
        <button class="nav-tab" data-tab="chat">
          ðŸ’¬ AI Chat
        </button>
        <button class="nav-tab" data-tab="wake">
          âš¡ System Commands
        </button>
      </nav>
      
      <div class="system-status">
        <div class="status-indicator">
          <div class="status-dot" id="connection-status"></div>
          <span id="system-status-text">Connected</span>
        </div>
      </div>
    </div>
  </header>

  <main class="system-main">
    <!-- =============== INBOX TAB =============== -->
    <section id="inbox" class="tab-panel active">
      <div class="panel-header">
        <div class="panel-title">
          <h1>Message Inbox</h1>
          <div class="panel-subtitle">Centralized notification and event management</div>
        </div>
      </div>

      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-label">Today</div>
          </div>
          <div class="metric-value" id="msg-today">0</div>
        </div>
        
        <div class="metric-card green">
          <div class="metric-header">
            <div class="metric-label">Archived</div>
          </div>
          <div class="metric-value" id="msg-arch">0</div>
        </div>
        
        <div class="metric-card red">
          <div class="metric-header">
            <div class="metric-label">Errors</div>
          </div>
          <div class="metric-value" id="msg-err">0</div>
        </div>
        
        <div class="metric-card orange">
          <div class="metric-header">
            <div class="metric-label">Auto-Purge</div>
          </div>
          <div class="metric-controls">
            <select id="purge-select">
              <option value="1">1 day</option>
              <option value="7" selected>7 days</option>
              <option value="30">30 days</option>
            </select>
            <button id="purge-now" class="btn danger">Run</button>
          </div>
        </div>
      </div>

      <div class="inbox-layout">
        <div class="panel">
          <div class="panel-head">
            <div class="flex gap-4">
              <div class="checkbox-group">
                <input type="checkbox" id="pv-follow" checked />
                <label for="pv-follow">Auto-preview new messages</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="keep-arch" />
                <label for="keep-arch">Keep archived when deleting all</label>
              </div>
            </div>
            <button id="del-all" class="btn danger">Delete All Messages</button>
          </div>
          
          <table class="data-table">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Source</th>
                <th>Title</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="msg-body">
              <tr><td colspan="4" class="text-center text-muted">Loading messages...</td></tr>
            </tbody>
          </table>
        </div>

        <div class="preview-panel">
          <div class="preview-header">
            <div>
              <div class="preview-title" id="pv-title">No message selected</div>
              <div class="preview-meta" id="pv-meta">â€”</div>
            </div>
          </div>
          <div class="preview-content" id="pv-body">
            <div class="text-center text-muted">Select a message to preview its contents</div>
          </div>
        </div>
      </div>
    </section>

    <!-- =============== CHAT TAB =============== -->
    <section id="chat" class="tab-panel">
      <div class="panel-header">
        <div class="panel-title">
          <h1>AI Chat Interface</h1>
          <div class="panel-subtitle">Natural conversation with Jarvis AI â€¢ Messages auto-prefixed with "chat"</div>
        </div>
        <div class="metrics-grid" style="margin: 0; grid-template-columns: auto auto;">
          <div class="metric-card cyan">
            <div class="metric-header">
              <div class="metric-label">Chat Status</div>
            </div>
            <div style="font-size: 14px; font-weight: 500;" id="chat-status">Ready</div>
          </div>
          <div class="metric-card purple">
            <div class="metric-controls">
              <button id="clear-chat" class="btn">Clear History</button>
            </div>
          </div>
        </div>
      </div>

      <div class="chat-container">
        <div class="chat-header">
          <div class="chat-title">ðŸ’¬ Conversation with Jarvis</div>
          <div class="chat-status">
            <div class="status-dot"></div>
            <span>Neural Network Active</span>
          </div>
        </div>
        
        <div class="chat-messages" id="chat-messages">
          <div class="chat-message bot">
            <div class="message-content">
              ðŸ‘‹ Hello! I'm Jarvis, your AI assistant. I can help you with information, analysis, creative tasks, and general conversation. What would you like to talk about?
            </div>
            <div class="message-time">System initialized</div>
          </div>
        </div>
        
        <div class="chat-input-area">
          <textarea 
            id="chat-input" 
            class="chat-input" 
            placeholder="Type your message here... (Press Ctrl+Enter to send)"
            rows="1"></textarea>
          <button id="chat-send" class="btn primary">
            Send Message
          </button>
        </div>
      </div>
    </section>

    <!-- =============== WAKE TAB =============== -->
    <section id="wake" class="tab-panel">
      <div class="panel-header">
        <div class="panel-title">
          <h1>System Commands</h1>
          <div class="panel-subtitle">Direct system control and automation â€¢ Commands auto-prefixed with "jarvis"</div>
        </div>
        <div class="metrics-grid" style="margin: 0; grid-template-columns: auto;">
          <div class="metric-card purple">
            <div class="metric-header">
              <div class="metric-label">Last Command</div>
            </div>
            <div style="font-size: 14px; font-weight: 500;" id="last-wake">No commands sent</div>
          </div>
        </div>
      </div>

      <div class="wake-container">
        <div class="wake-input-panel">
          <h3 style="margin-bottom: 16px; color: var(--text-primary);">Send System Command</h3>
          <p style="color: var(--text-muted); font-size: 14px; margin-bottom: 20px;">
            Commands are automatically prefixed with "jarvis" and sent to the system processor.
          </p>
          
          <div class="wake-input-group">
            <div class="wake-prefix">jarvis</div>
            <input 
              type="text" 
              id="wake-input" 
              class="wake-input"
              placeholder="turn on lights, weather, digest, help..."
            />
            <button id="wake-send" class="btn primary">Execute</button>
          </div>
          
          <div style="margin-top: 16px;">
            <h4 style="color: var(--text-secondary); margin-bottom: 8px; font-size: 14px;">Common Commands:</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px;">
              <button class="btn" onclick="document.getElementById('wake-input').value='weather'; document.getElementById('wake-send').click();">weather</button>
              <button class="btn" onclick="document.getElementById('wake-input').value='digest'; document.getElementById('wake-send').click();">digest</button>
              <button class="btn" onclick="document.getElementById('wake-input').value='help'; document.getElementById('wake-send').click();">help</button>
              <button class="btn" onclick="document.getElementById('wake-input').value='kuma'; document.getElementById('wake-send').click();">uptime</button>
            </div>
          </div>
        </div>
        
        <div class="wake-input-panel">
          <h3 style="margin-bottom: 16px; color: var(--text-primary);">Command History</h3>
          <div class="wake-history" id="wake-history">
            <div class="text-center text-muted">No commands executed yet</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <div id="toast"></div>
  <script src="app.js?v=3.0"></script>
</body>
</html>
