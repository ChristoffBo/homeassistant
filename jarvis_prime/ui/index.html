<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Jarvis Prime Control System</title>
  
  <script>window.JARVIS_API_BASE = window.JARVIS_API_BASE || null;</script>
  
  <script>
    (function () {
      var p = location.pathname;
      if (p.endsWith('/index.html')) p = p.slice(0, -'index.html'.length);
      var dir = p.endsWith('/') ? p : p.replace(/[^\/]*$/, '');
      if (!dir.endsWith('/') && dir !== '') dir += '/';
      document.write('<base href="' + dir + '">');
    })();
  </script>

  <link rel="stylesheet" href="style.css?v=4.1" />
  
  <!-- Favicon / Browser tab icons -->
  <link rel="icon" href="/icon/icon-16x16.png" sizes="16x16" type="image/png">
  <link rel="icon" href="/icon/icon-32x32.png" sizes="32x32" type="image/png">
  <link rel="apple-touch-icon" href="/icon/icon-192x192.png" sizes="192x192">
  <link rel="apple-touch-icon" href="/icon/icon-512x512.png" sizes="512x512">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#00e5ff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Jarvis">
  <meta name="msapplication-TileColor" content="#001224">
</head>

<body>
  <!-- ULTRA GLASS NAVIGATION -->
  <nav class="glass-nav">
    <div class="nav-container">
      <div class="nav-brand">
        <div class="brand-icon">
          <img src="/icon/icon-512x512.png" alt="Jarvis" />
        </div>
        <div class="brand-text">
          <h1>Jarvis Prime</h1>
          <p>Control System</p>
        </div>
      </div>
      
      <ul class="nav-tabs">
        <li class="nav-tab active" data-tab="dashboard">Dashboard</li>
        <li class="nav-tab" data-tab="inbox">Inbox</li>
        <li class="nav-tab" data-tab="orchestrator">Orchestrator</li>
        <li class="nav-tab" data-tab="analytics">Analytics</li>
      </ul>
      
      <div class="system-status">
        <div class="status-indicator">
          <div class="status-dot" id="connection-status"></div>
          <span id="system-status-text">Connected</span>
        </div>
        <button id="theme-toggle" class="btn" style="margin-left: 12px; padding: 8px 16px;" title="Toggle Dark Mode">
          <span id="theme-icon">🌙</span>
        </button>
      </div>
    </div>
  </nav>

  <main class="main-container">
    <!-- ========================================
         DASHBOARD TAB
         ======================================== -->
    <section id="dashboard" class="tab-panel active">
      <div class="page-header">
        <h2 class="page-title">System Overview</h2>
        <p class="page-subtitle">Real-time metrics from all modules</p>
      </div>
      
      <!-- Metrics Grid - 8 Cards -->
      <div class="metrics-grid-dashboard">
        <!-- 1. Total Messages -->
        <div class="metric-card" onclick="switchTab('inbox')">
          <div class="metric-header">
            <div>
              <div class="metric-value" id="dash-inbox-total">0</div>
              <div class="metric-label">Total Messages</div>
            </div>
            <div class="metric-icon" style="background: rgba(0, 255, 136, 0.12); color: #00ff88;">
              <svg class="icon icon-lg" fill="none" viewBox="0 0 24 24">
                <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
        </div>
        
        <!-- 2. Messages Today -->
        <div class="metric-card" onclick="switchTab('inbox')">
          <div class="metric-header">
            <div>
              <div class="metric-value" id="dash-inbox-today">0</div>
              <div class="metric-label">Messages Today</div>
            </div>
            <div class="metric-icon" style="background: rgba(0, 229, 255, 0.12); color: #00e5ff;">
              <svg class="icon icon-lg" fill="none" viewBox="0 0 24 24">
                <path d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
        </div>
        
        <!-- 3. Error Messages -->
        <div class="metric-card" onclick="switchTab('inbox')">
          <div class="metric-header">
            <div>
              <div class="metric-value" id="dash-inbox-errors">0</div>
              <div class="metric-label">Error Messages</div>
            </div>
            <div class="metric-icon" style="background: rgba(239, 68, 68, 0.12); color: #ef4444;">
              <svg class="icon icon-lg" fill="none" viewBox="0 0 24 24">
                <path d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
        </div>
        
        <!-- 4. Chat Status -->
        <div class="metric-card" onclick="switchTab('inbox')">
          <div class="metric-header">
            <div>
              <div class="metric-value" id="dash-chat-status">Ready</div>
              <div class="metric-label">Chat Status</div>
            </div>
            <div class="metric-icon" style="background: rgba(0, 229, 255, 0.12); color: var(--cyan-electric);">
              <svg class="icon icon-lg" fill="none" viewBox="0 0 24 24">
                <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
          <div class="metric-change">
            <span style="color: var(--text-muted);">AI assistant active</span>
          </div>
        </div>
        
        <!-- 5. Commands -->
        <div class="metric-card" onclick="switchTab('inbox')">
          <div class="metric-header">
            <div>
              <div class="metric-value" id="dash-commands">0</div>
              <div class="metric-label">Commands</div>
            </div>
            <div class="metric-icon" style="background: rgba(77, 184, 255, 0.12); color: var(--blue-light);">
              <svg class="icon icon-lg" fill="none" viewBox="0 0 24 24">
                <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
          <div class="metric-change">
            <span style="color: var(--text-muted);" id="dash-last-command">No commands sent</span>
          </div>
        </div>
        
        <!-- 6. Active Playbooks -->
        <div class="metric-card" onclick="switchTab('orchestrator')">
          <div class="metric-header">
            <div>
              <div class="metric-value" id="dash-playbooks">0</div>
              <div class="metric-label">Active Playbooks</div>
            </div>
            <div class="metric-icon" style="background: rgba(255, 170, 0, 0.12); color: #ffaa00;">
              <svg class="icon icon-lg" fill="none" viewBox="0 0 24 24">
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                <path d="M12 1v6m0 6v6m8.66-15.66l-4.24 4.24m-8.48 8.48l-4.24 4.24M23 12h-6M7 12H1m16.66 8.66l-4.24-4.24m-8.48-8.48L.34 3.34" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
          <div class="metric-change">
            <span style="color: var(--text-muted);" id="dash-schedules">0 scheduled</span>
          </div>
        </div>
        
        <!-- 7. System Health -->
        <div class="metric-card" onclick="switchTab('analytics')">
          <div class="metric-header">
            <div>
              <div class="metric-value" id="dash-health">0%</div>
              <div class="metric-label">System Health</div>
            </div>
            <div class="metric-icon" style="background: rgba(0, 255, 136, 0.12); color: #00ff88;">
              <svg class="icon icon-lg" fill="none" viewBox="0 0 24 24">
                <path d="M3 3v18h18M7 16l4-4 4 4 6-6" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
          <div class="metric-change positive">
            <span>All services</span>
            <span class="status-badge status-online">
              <span class="status-dot"></span>
              Online
            </span>
          </div>
        </div>
        
        <!-- 8. Orchestration Success/Errors -->
        <div class="metric-card" onclick="switchTab('orchestrator')">
          <div class="metric-header">
            <div>
              <div class="metric-value">
                <span id="dash-orch-success" style="color: #00ff88;">0</span> / 
                <span id="dash-orch-errors" style="color: #ef4444;">0</span>
              </div>
              <div class="metric-label">Orchestration Jobs</div>
            </div>
            <div class="metric-icon" style="background: rgba(139, 92, 246, 0.12); color: #8b5cf6;">
              <svg class="icon icon-lg" fill="none" viewBox="0 0 24 24">
                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" stroke="currentColor" stroke-width="2"/>
              </svg>
            </div>
          </div>
          <div class="metric-change">
            <span style="color: #00ff88;">Success</span>
            <span style="color: var(--text-muted);">/</span>
            <span style="color: #ef4444;">Failed</span>
          </div>
        </div>
      </div>
      
      <!-- Recent Activity -->
      <div class="glass-card" style="margin-top: 32px;">
        <div class="card-header">
          <h3 class="card-title">Recent Activity</h3>
          <span class="status-badge status-online">
            <span class="status-dot"></span>
            Live
          </span>
        </div>
        <div class="card-body">
          <ul class="activity-list" id="dash-activity">
            <li class="activity-item">
              <div class="activity-icon" style="background: rgba(0, 255, 136, 0.12); color: #00ff88;">
                <svg class="icon" fill="none" viewBox="0 0 24 24">
                  <path d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke="currentColor" stroke-width="2"/>
                </svg>
              </div>
              <div class="activity-content">
                <div class="activity-title">System initialized</div>
                <div class="activity-time">Just now</div>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </section>

    <!-- ========================================
         INBOX TAB (MERGED: Messages + Chat + Commands)
         ======================================== -->
    <section id="inbox" class="tab-panel">
      <div class="panel-header">
        <div class="panel-title">
          <h1>Inbox & Communications</h1>
          <div class="panel-subtitle">Messages, AI Chat & System Commands</div>
        </div>
      </div>

      <!-- Metrics -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-label">Today</div>
          </div>
          <div class="metric-value" id="msg-today">0</div>
        </div>
        
        <div class="metric-card green">
          <div class="metric-header">
            <div class="metric-label">Archived</div>
          </div>
          <div class="metric-value" id="msg-arch">0</div>
        </div>
        
        <div class="metric-card red">
          <div class="metric-header">
            <div class="metric-label">Errors</div>
          </div>
          <div class="metric-value" id="msg-err">0</div>
        </div>
        
        <div class="metric-card cyan">
          <div class="metric-header">
            <div class="metric-label">Chat Status</div>
          </div>
          <div style="font-size: 14px; font-weight: 500;" id="chat-status">Ready</div>
        </div>
        
        <div class="metric-card orange">
          <div class="metric-header">
            <div class="metric-label">Auto-Purge</div>
          </div>
          <div class="metric-controls">
            <select id="purge-select">
              <option value="1">1 day</option>
              <option value="7" selected>7 days</option>
              <option value="30">30 days</option>
            </select>
            <button id="purge-now" class="btn danger">Run</button>
          </div>
        </div>
      </div>

      <!-- Chat & Command Input -->
      <div class="inbox-comms-grid">
        <!-- AI Chat -->
        <div class="glass-card">
          <div class="card-header">
            <h3 class="card-title">AI Assistant</h3>
            <svg class="icon" fill="none" viewBox="0 0 24 24" style="color: var(--cyan-electric);">
              <path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2v10z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="chat-input-group">
            <textarea 
              id="chat-input" 
              class="chat-input" 
              placeholder="Type your message to Jarvis AI... (Ctrl+Enter to send)"
              rows="1"></textarea>
            <button id="chat-send" class="btn primary">Send</button>
          </div>
        </div>

        <!-- System Commands -->
        <div class="glass-card">
          <div class="card-header">
            <h3 class="card-title">System Commands</h3>
            <svg class="icon" fill="none" viewBox="0 0 24 24" style="color: var(--blue-light);">
              <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" stroke="currentColor" stroke-width="2"/>
            </svg>
          </div>
          <div class="wake-input-group">
            <div class="wake-prefix">jarvis</div>
            <input 
              type="text" 
              id="wake-input" 
              class="wake-input"
              placeholder="weather, digest, help..."
            />
            <button id="wake-send" class="btn primary">Execute</button>
          </div>
          <div style="margin-top: 12px; font-size: 12px; color: var(--text-muted);">
            Last: <span id="last-wake">No commands sent</span>
          </div>
        </div>
      </div>

      <!-- Messages Table -->
      <div class="inbox-layout">
        <div class="panel">
          <div class="panel-head">
            <div class="flex gap-4">
              <div class="checkbox-group">
                <input type="checkbox" id="pv-follow" checked />
                <label for="pv-follow">Auto-preview new messages</label>
              </div>
              <div class="checkbox-group">
                <input type="checkbox" id="keep-arch" />
                <label for="keep-arch">Keep archived when deleting all</label>
              </div>
            </div>
            <button id="del-all" class="btn danger">Delete All Messages</button>
          </div>
          
          <table class="data-table">
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Source</th>
                <th>Title</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="msg-body">
              <tr><td colspan="4" class="text-center text-muted">Loading messages...</td></tr>
            </tbody>
          </table>
        </div>

        <div class="preview-panel">
          <div class="preview-header">
            <div>
              <div class="preview-title" id="pv-title">No message selected</div>
              <div class="preview-meta" id="pv-meta">—</div>
            </div>
          </div>
          <div class="preview-content" id="pv-body">
            <div class="text-center text-muted">Select a message to preview its contents</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ORCHESTRATOR TAB -->
    <section id="orchestrator" class="tab-panel">
      <div class="panel-header">
        <div class="panel-title">
          <h1>Automation Orchestrator</h1>
          <div class="panel-subtitle">Manage servers, run playbooks, and schedule automated tasks</div>
        </div>
      </div>

      <div class="orch-tabs">
        <button class="orch-tab active" data-orch-tab="playbooks">Playbooks</button>
        <button class="orch-tab" data-orch-tab="servers">Servers</button>
        <button class="orch-tab" data-orch-tab="schedules">Schedules</button>
        <button class="orch-tab" data-orch-tab="history">History</button>
      </div>

      <!-- PLAYBOOKS PANEL -->
      <div id="orch-playbooks" class="orch-panel active">
        <div class="panel">
          <div class="panel-head">
            <h3>Available Playbooks</h3>
            <button class="btn primary" onclick="orchRefreshPlaybooks()">Refresh</button>
          </div>
          <div id="playbooks-list" class="playbooks-grid">
            <div class="text-center text-muted">Loading playbooks...</div>
          </div>
        </div>

        <div class="panel" style="margin-top: 24px;">
          <div class="panel-head">
            <h3>Live Output</h3>
          </div>
          <div class="log-output" id="orch-logs"></div>
        </div>
      </div>

      <!-- SERVERS PANEL -->
      <div id="orch-servers" class="orch-panel">
        <div class="panel">
          <div class="panel-head">
            <h3>Server Inventory</h3>
            <button class="btn primary" onclick="orchShowAddServer()">Add Server</button>
          </div>
          <div id="servers-list">
            <div class="text-center text-muted">Loading servers...</div>
          </div>
        </div>
      </div>

      <!-- SCHEDULES PANEL -->
      <div id="orch-schedules" class="orch-panel">
        <div class="panel">
          <div class="panel-head">
            <h3>Job Schedules</h3>
            <button class="btn primary" onclick="orchShowAddSchedule()">Add Schedule</button>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Playbook</th>
                <th>Schedule</th>
                <th>Server Group</th>
                <th>Last Run</th>
                <th>Next Run</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="schedules-list">
              <tr><td colspan="7" class="text-center text-muted">Loading schedules...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- HISTORY PANEL -->
      <div id="orch-history" class="orch-panel">
        <div class="panel">
          <div class="panel-head">
            <h3>Job History</h3>
            <div style="display: flex; gap: 8px;">
              <button class="btn" onclick="orchLoadHistory()">Refresh</button>
              <button class="btn" onclick="orchShowHistorySettings()">Manage History</button>
            </div>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Playbook</th>
                <th>Status</th>
                <th>Started</th>
                <th>Completed</th>
                <th>Exit Code</th>
                <th>Triggered By</th>
              </tr>
            </thead>
            <tbody id="history-list">
              <tr><td colspan="6" class="text-center text-muted">Loading history...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- ANALYTICS TAB -->
    <section id="analytics" class="tab-panel">
      <div class="panel-header">
        <div class="panel-title">
          <h1>Analytics & Monitoring</h1>
          <div class="panel-subtitle">Real-time homelab health monitoring and uptime tracking</div>
        </div>
      </div>

      <!-- Health Score Metrics -->
      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-header">
            <div class="metric-label">Health Score</div>
          </div>
          <div class="metric-value" id="health-score" style="font-size: 48px;">0%</div>
        </div>
        
        <div class="metric-card green">
          <div class="metric-header">
            <div class="metric-label">Services Up</div>
          </div>
          <div class="metric-value" id="services-up">0</div>
        </div>
        
        <div class="metric-card red">
          <div class="metric-header">
            <div class="metric-label">Services Down</div>
          </div>
          <div class="metric-value" id="services-down">0</div>
        </div>
        
        <div class="metric-card cyan">
          <div class="metric-header">
            <div class="metric-label">Total Monitored</div>
          </div>
          <div class="metric-value" id="services-total">0</div>
        </div>
      </div>

      <!-- Reset & Purge Controls -->
      <div style="margin: 20px 0; display: flex; gap: 12px; flex-wrap: wrap;">
        <button class="btn" onclick="analyticsResetHealth()" 
                style="background: rgba(255, 149, 0, 0.1); border: 1px solid rgba(255, 149, 0, 0.3); color: #fb923c;">
          Reset Health Scores
        </button>
        <button class="btn" onclick="analyticsResetIncidents()" 
                style="background: rgba(255, 69, 58, 0.1); border: 1px solid rgba(255, 69, 58, 0.3); color: #ef4444;">
          Clear All Incidents
        </button>
        
        <button class="btn" onclick="analyticsPurgeWeek()" 
                style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: #8b5cf6;">
          Purge 1 Week
        </button>
        <button class="btn" onclick="analyticsPurgeMonth()" 
                style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: #8b5cf6;">
          Purge 1 Month
        </button>
        <button class="btn" onclick="analyticsPurgeAll()" 
                style="background: rgba(239, 68, 68, 0.15); border: 1px solid rgba(239, 68, 68, 0.4); color: #ef4444;">
          Purge ALL
        </button>
      </div>

      <div class="orch-tabs">
        <button class="orch-tab active" data-analytics-tab="dashboard">Dashboard</button>
        <button class="orch-tab" data-analytics-tab="services">Services</button>
        <button class="orch-tab" data-analytics-tab="incidents">Incidents</button>
      </div>

      <!-- DASHBOARD PANEL -->
      <div id="analytics-dashboard" class="orch-panel active">
        <div class="panel">
          <div class="panel-head">
            <h3>Service Status Overview</h3>
            <button class="btn primary" onclick="analyticsRefresh()">Refresh</button>
          </div>
          <div id="analytics-services-grid" class="playbooks-grid">
            <div class="text-center text-muted">Loading services...</div>
          </div>
        </div>
      </div>

      <!-- SERVICES MANAGEMENT PANEL -->
      <div id="analytics-services" class="orch-panel">
        <div class="panel">
          <div class="panel-head">
            <h3>Monitored Services</h3>
            <button class="btn primary" onclick="analyticsShowAddService()">Add Service</button>
          </div>
          <table class="data-table">
            <thead>
              <tr>
                <th>Service Name</th>
                <th>Endpoint</th>
                <th>Type</th>
                <th>Interval</th>
                <th>Status</th>
                <th>Enabled</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="analytics-services-list">
              <tr><td colspan="7" class="text-center text-muted">Loading services...</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- INCIDENTS PANEL -->
      <div id="analytics-incidents" class="orch-panel">
        <div class="panel">
          <div class="panel-head">
            <h3>Recent Incidents (Last 7 Days)</h3>
            <button class="btn primary" onclick="analyticsLoadIncidents()">Refresh</button>
          </div>
          <div id="analytics-incidents-list" style="margin-top: 16px;">
            <div class="text-center text-muted">Loading incidents...</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- MODALS -->
  <div id="server-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add Server</h2>
        <button class="btn" onclick="orchCloseServerModal()">✕</button>
      </div>
      <form id="server-form" onsubmit="orchSaveServer(event)">
        <div class="form-group">
          <label class="form-label">Server Name *</label>
          <input type="text" id="srv-name" required placeholder="web-server-01">
        </div>
        <div class="form-group">
          <label class="form-label">IP Address / Hostname *</label>
          <input type="text" id="srv-host" required placeholder="192.168.1.100">
        </div>
        <div class="form-group">
          <label class="form-label">SSH Port</label>
          <input type="number" id="srv-port" value="22">
        </div>
        <div class="form-group">
          <label class="form-label">Username *</label>
          <input type="text" id="srv-user" required placeholder="root">
        </div>
        <div class="form-group">
          <label class="form-label">Password *</label>
          <input type="password" id="srv-pass" required placeholder="Enter SSH password">
        </div>
        <div class="form-group">
          <label class="form-label">Groups (comma-separated)</label>
          <input type="text" id="srv-groups" placeholder="web, production">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea id="srv-desc" rows="3" placeholder="Production web server"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn" onclick="orchCloseServerModal()">Cancel</button>
          <button type="submit" class="btn primary">Save Server</button>
        </div>
      </form>
    </div>
  </div>

  <div id="edit-server-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Server</h2>
        <button class="btn" onclick="orchCloseEditServerModal()">✕</button>
      </div>
      <form id="edit-server-form" onsubmit="orchUpdateServer(event)">
        <input type="hidden" id="edit-srv-id">
        <div class="form-group">
          <label class="form-label">Server Name *</label>
          <input type="text" id="edit-srv-name" required placeholder="web-server-01">
        </div>
        <div class="form-group">
          <label class="form-label">IP Address / Hostname *</label>
          <input type="text" id="edit-srv-host" required placeholder="192.168.1.100">
        </div>
        <div class="form-group">
          <label class="form-label">SSH Port</label>
          <input type="number" id="edit-srv-port" value="22">
        </div>
        <div class="form-group">
          <label class="form-label">Username *</label>
          <input type="text" id="edit-srv-user" required placeholder="root">
        </div>
        <div class="form-group">
          <label class="form-label">Password</label>
          <input type="password" id="edit-srv-pass" placeholder="Leave blank to keep current password">
          <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
            Only enter a new password if you want to change it
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Groups (comma-separated)</label>
          <input type="text" id="edit-srv-groups" placeholder="web, production">
        </div>
        <div class="form-group">
          <label class="form-label">Description</label>
          <textarea id="edit-srv-desc" rows="3" placeholder="Production web server"></textarea>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn" onclick="orchCloseEditServerModal()">Cancel</button>
          <button type="submit" class="btn primary">Update Server</button>
        </div>
      </form>
    </div>
  </div>

  <div id="schedule-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create Schedule</h2>
        <button class="btn" onclick="orchCloseScheduleModal()">✕</button>
      </div>
      <form id="schedule-form" onsubmit="orchSaveSchedule(event)">
        <div class="form-group">
          <label class="form-label">Playbook *</label>
          <select id="sched-playbook" required>
            <option value="">Select a playbook...</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Server Group</label>
          <input type="text" id="sched-group" placeholder="web, all (optional)">
        </div>
        <div class="form-group">
          <label class="form-label">Schedule Preset</label>
          <select id="sched-preset" onchange="orchApplyPreset()">
            <option value="">Custom...</option>
            <option value="0 2 * * *">Every day at 2 AM</option>
            <option value="0 8 * * 1">Every Monday at 8 AM</option>
            <option value="0 0 * * *">Daily at midnight</option>
            <option value="0 */6 * * *">Every 6 hours</option>
            <option value="0 * * * *">Every hour</option>
            <option value="*/15 * * * *">Every 15 minutes</option>
          </select>
        </div>
        <div class="form-group">
          <label class="form-label">Cron Expression *</label>
          <input type="text" id="sched-cron" required placeholder="0 2 * * *" pattern="[0-9\*\-\,\/ ]+">
          <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
            Format: minute hour day month weekday (e.g., "0 2 * * *" = 2 AM daily)
          </div>
        </div>
        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="sched-notify" checked />
            <label for="sched-notify">Send notification when job completes</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn" onclick="orchCloseScheduleModal()">Cancel</button>
          <button type="submit" class="btn primary">Create Schedule</button>
        </div>
      </form>
    </div>
  </div>

  <div id="history-modal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2>Manage History</h2>
        <button class="btn" onclick="orchCloseHistoryModal()">✕</button>
      </div>
      
      <div class="form-group">
        <label class="form-label">Quick Actions</label>
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
          <button class="btn" onclick="orchPurgeHistory('failed')">Delete Failed Jobs</button>
          <button class="btn" onclick="orchPurgeHistory('completed')">Delete Successful Jobs</button>
          <button class="btn" onclick="orchPurgeHistory('older_than_30')">Delete Older Than 30 Days</button>
          <button class="btn" onclick="orchPurgeHistory('older_than_90')">Delete Older Than 90 Days</button>
        </div>
      </div>

      <div style="background: var(--surface-tertiary); border-radius: 8px; padding: 16px; margin: 20px 0;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
          <span style="color: var(--text-muted); font-size: 14px;">Total Entries:</span>
          <span id="history-total" style="color: var(--text-primary); font-weight: 600;">—</span>
        </div>
      </div>

      <div style="background: rgba(255, 59, 48, 0.1); border: 1px solid rgba(255, 59, 48, 0.3); border-radius: 8px; padding: 16px;">
        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
          <span style="font-size: 24px;">⚠️</span>
          <span style="color: #ff3b30; font-weight: 600;">Danger Zone</span>
        </div>
        <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 12px;">
          Permanently delete all execution history. This action cannot be undone.
        </p>
        <button class="btn danger" style="width: 100%;" onclick="orchPurgeHistory('all')">Delete ALL History</button>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn" onclick="orchCloseHistoryModal()">Close</button>
      </div>
    </div>
  </div>

  <div id="analytics-service-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="analytics-service-modal-title">Add Service</h2>
        <button class="btn" onclick="analyticsCloseServiceModal()">✕</button>
      </div>
      <form id="analytics-service-form" onsubmit="analyticsSaveService(event)">
        <input type="hidden" id="analytics-service-id">
        
        <div class="form-group">
          <label class="form-label">Service Name *</label>
          <input type="text" id="analytics-service-name" required placeholder="Home Assistant">
        </div>
        
        <div class="form-group">
          <label class="form-label">Endpoint *</label>
          <input type="text" id="analytics-service-endpoint" required placeholder="http://homeassistant.local:8123 or 192.168.1.100:22 or 8.8.8.8">
          <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
            HTTP: Full URL with protocol • TCP: host:port • Ping: hostname or IP
          </div>
        </div>
        
        <div class="form-group">
          <label class="form-label">Check Type *</label>
          <select id="analytics-check-type" required onchange="analyticsToggleStatusCode()">
            <option value="http">HTTP - Web endpoint</option>
            <option value="tcp">TCP - Port check</option>
            <option value="ping">ICMP Ping - Host reachability</option>
          </select>
        </div>
        
        <div class="form-group" id="analytics-status-code-group">
          <label class="form-label">Expected HTTP Status Code</label>
          <input type="number" id="analytics-expected-status" value="200" min="100" max="599">
        </div>
        
        <div class="form-group">
          <label class="form-label">Check Interval (seconds)</label>
          <input type="number" id="analytics-check-interval" value="60" min="10" max="3600">
        </div>
        
        <div class="form-group">
          <label class="form-label">Timeout (seconds)</label>
          <input type="number" id="analytics-check-timeout" value="5" min="1" max="30">
        </div>
        
        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="analytics-service-enabled" checked />
            <label for="analytics-service-enabled">Enable monitoring for this service</label>
          </div>
        </div>
        
        <div class="modal-footer">
          <button type="button" class="btn" onclick="analyticsCloseServiceModal()">Cancel</button>
          <button type="submit" class="btn primary">Save Service</button>
        </div>
      </form>
    </div>
  </div>

  <div id="toast"></div>
  <script src="app.js?v=4.1"></script>
  <script src="orchestrator.js?v=1.1"></script>
  <script src="analytics.js?v=1.0"></script>
</body>
</html>
