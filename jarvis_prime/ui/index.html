<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jarvis Prime</title>
  <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Sidebar Navigation -->
    <nav class="sidebar">
      <div class="sidebar-header">
        <div class="logo">üß†</div>
        <div class="brand">Jarvis Prime</div>
      </div>
      
      <ul class="nav-menu">
        <li class="nav-tab active" data-tab="inbox">
          <span class="nav-icon">üì•</span>
          <span class="nav-label">Inbox</span>
        </li>
        <li class="nav-tab" data-tab="chat">
          <span class="nav-icon">üí¨</span>
          <span class="nav-label">Chat</span>
        </li>
        <li class="nav-tab" data-tab="orchestrator">
          <span class="nav-icon">üéØ</span>
          <span class="nav-label">Orchestrator</span>
        </li>
        <li class="nav-tab" data-tab="analytics">
          <span class="nav-icon">üìä</span>
          <span class="nav-label">Analytics</span>
        </li>
        <li class="nav-tab" data-tab="settings">
          <span class="nav-icon">‚öôÔ∏è</span>
          <span class="nav-label">Settings</span>
        </li>
      </ul>
      
      <div class="sidebar-footer">
        <div class="status-indicator">
          <span class="status-dot"></span>
          <span class="status-text">Online</span>
        </div>
      </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
      
      <!-- INBOX TAB -->
      <section id="inbox" class="tab-panel active">
        <div class="panel-header">
          <div class="panel-title">
            <h1>Inbox</h1>
            <div class="panel-subtitle">Your message center</div>
          </div>
          <div class="panel-actions">
            <button class="btn btn-primary" onclick="inboxRefresh()">üîÑ Refresh</button>
          </div>
        </div>

        <div class="inbox-container">
          <div class="inbox-list" id="inbox-list">
            <div class="loading">Loading messages...</div>
          </div>
          
          <div class="inbox-detail" id="inbox-detail">
            <div class="empty-state">
              <div class="empty-icon">üì≠</div>
              <div class="empty-text">Select a message to view</div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- CHAT TAB -->
      <section id="chat" class="tab-panel">
        <div class="panel-header">
          <div class="panel-title">
            <h1>Chat</h1>
            <div class="panel-subtitle">Conversation with Jarvis</div>
          </div>
        </div>

        <div class="chat-container">
          <div class="chat-messages" id="chat-messages">
            <div class="chat-welcome">
              <div class="chat-welcome-icon">üß†</div>
              <div class="chat-welcome-title">Welcome to Jarvis Prime</div>
              <div class="chat-welcome-text">Start a conversation to get assistance</div>
            </div>
          </div>
          
          <div class="chat-input-container">
            <textarea 
              id="chat-input" 
              class="chat-input" 
              placeholder="Type your message..."
              rows="3"
            ></textarea>
            <button class="btn btn-primary chat-send-btn" onclick="chatSendMessage()">
              Send
            </button>
          </div>
        </div>
      </section>
      
      <!-- ORCHESTRATOR TAB -->
      <section id="orchestrator" class="tab-panel">
        <div class="panel-header">
          <div class="panel-title">
            <h1>Orchestrator</h1>
            <div class="panel-subtitle">Manage automated workflows and schedules</div>
          </div>
          <div class="panel-actions">
            <button class="btn btn-primary" onclick="orchestratorShowNewModal()">+ New Orchestration</button>
          </div>
        </div>

        <!-- Orchestrator Sub-tabs -->
        <div class="orch-tabs">
          <button class="orch-tab active" data-orch-tab="active">Active</button>
          <button class="orch-tab" data-orch-tab="schedule">Schedule</button>
          <button class="orch-tab" data-orch-tab="history">History</button>
        </div>

        <!-- Active Orchestrations Panel -->
        <div id="orch-active-panel" class="orch-panel active">
          <div class="panel">
            <div class="panel-head">
              <h3>Active Orchestrations</h3>
              <button class="btn btn-sm" onclick="orchestratorRefreshActive()">üîÑ Refresh</button>
            </div>
            <div id="orch-active-list" class="orch-list">
              <div class="loading">Loading orchestrations...</div>
            </div>
          </div>
        </div>

        <!-- Schedule Panel -->
        <div id="orch-schedule-panel" class="orch-panel">
          <div class="panel">
            <div class="panel-head">
              <h3>Scheduled Tasks</h3>
              <button class="btn btn-sm" onclick="orchestratorRefreshSchedule()">üîÑ Refresh</button>
            </div>
            <div id="orch-schedule-list" class="orch-list">
              <div class="loading">Loading schedules...</div>
            </div>
          </div>
        </div>

        <!-- History Panel -->
        <div id="orch-history-panel" class="orch-panel">
          <div class="panel">
            <div class="panel-head">
              <h3>Execution History</h3>
              <button class="btn btn-sm" onclick="orchestratorRefreshHistory()">üîÑ Refresh</button>
            </div>
            <div id="orch-history-list" class="orch-list">
              <div class="loading">Loading history...</div>
            </div>
          </div>
        </div>
      </section>

      <!-- New Orchestration Modal -->
      <div id="orch-new-modal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Create New Orchestration</h2>
            <button class="modal-close" onclick="orchestratorCloseNewModal()">&times;</button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label>Playbook</label>
              <select id="orch-new-playbook" class="form-control">
                <option value="">Select playbook...</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Schedule Type</label>
              <select id="orch-new-schedule-type" class="form-control" onchange="orchestratorToggleScheduleFields()">
                <option value="once">Run Once</option>
                <option value="interval">Recurring Interval</option>
                <option value="cron">Cron Expression</option>
              </select>
            </div>
            
            <div id="orch-schedule-once" class="schedule-options">
              <div class="form-group">
                <label>Run At</label>
                <input type="datetime-local" id="orch-new-run-at" class="form-control">
              </div>
            </div>
            
            <div id="orch-schedule-interval" class="schedule-options" style="display: none;">
              <div class="form-group">
                <label>Interval (minutes)</label>
                <input type="number" id="orch-new-interval" class="form-control" min="1" placeholder="60">
              </div>
            </div>
            
            <div id="orch-schedule-cron" class="schedule-options" style="display: none;">
              <div class="form-group">
                <label>Cron Expression</label>
                <input type="text" id="orch-new-cron" class="form-control" placeholder="0 */6 * * *">
              </div>
            </div>
            
            <div class="form-group">
              <label>Parameters (JSON)</label>
              <textarea id="orch-new-params" class="form-control" rows="4" placeholder='{}'></textarea>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn" onclick="orchestratorCloseNewModal()">Cancel</button>
            <button class="btn btn-primary" onclick="orchestratorCreateNew()">Create</button>
          </div>
        </div>
      </div>
      
      <!-- ANALYTICS TAB -->
      <section id="analytics" class="tab-panel">
        <div class="panel-header">
          <div class="panel-title">
            <h1>Analytics</h1>
            <div class="panel-subtitle">System insights and metrics</div>
          </div>
        </div>

        <!-- Analytics Sub-tabs -->
        <div class="orch-tabs">
          <button class="orch-tab active" data-analytics-tab="overview">Overview</button>
          <button class="orch-tab" data-analytics-tab="messages">Messages</button>
          <button class="orch-tab" data-analytics-tab="orchestrations">Orchestrations</button>
          <button class="orch-tab" data-analytics-tab="performance">Performance</button>
        </div>

        <!-- Overview Panel -->
        <div id="analytics-overview-panel" class="orch-panel active">
          <div class="analytics-grid">
            <div class="analytics-card">
              <div class="analytics-card-title">Total Messages</div>
              <div class="analytics-card-value" id="analytics-total-messages">-</div>
              <div class="analytics-card-subtitle">All time</div>
            </div>
            
            <div class="analytics-card">
              <div class="analytics-card-title">Active Orchestrations</div>
              <div class="analytics-card-value" id="analytics-active-orch">-</div>
              <div class="analytics-card-subtitle">Running now</div>
            </div>
            
            <div class="analytics-card">
              <div class="analytics-card-title">Today's Messages</div>
              <div class="analytics-card-value" id="analytics-today-messages">-</div>
              <div class="analytics-card-subtitle">Last 24 hours</div>
            </div>
            
            <div class="analytics-card">
              <div class="analytics-card-title">System Uptime</div>
              <div class="analytics-card-value" id="analytics-uptime">-</div>
              <div class="analytics-card-subtitle">Since last restart</div>
            </div>
          </div>
        </div>

        <!-- Messages Panel -->
        <div id="analytics-messages-panel" class="orch-panel">
          <div class="panel">
            <div class="panel-head">
              <h3>Message Analytics</h3>
            </div>
            <div style="padding: 20px;">
              <canvas id="analytics-messages-chart"></canvas>
            </div>
          </div>
        </div>

        <!-- Orchestrations Panel -->
        <div id="analytics-orchestrations-panel" class="orch-panel">
          <div class="panel">
            <div class="panel-head">
              <h3>Orchestration Analytics</h3>
            </div>
            <div style="padding: 20px;">
              <canvas id="analytics-orch-chart"></canvas>
            </div>
          </div>
        </div>

        <!-- Performance Panel -->
        <div id="analytics-performance-panel" class="orch-panel">
          <div class="panel">
            <div class="panel-head">
              <h3>Performance Metrics</h3>
            </div>
            <div style="padding: 20px;">
              <div id="analytics-performance-content">Loading performance data...</div>
            </div>
          </div>
        </div>
      </section>
      
      <!-- SETTINGS TAB -->
      <section id="settings" class="tab-panel">
        <div class="panel-header">
          <div class="panel-title">
            <h1>System Settings</h1>
            <div class="panel-subtitle">Configure Jarvis Prime modules and features</div>
          </div>
        </div>

        <!-- HA Readonly Banner -->
        <div id="settings-readonly-banner" style="display: none; background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.4); border-radius: 8px; padding: 16px; margin-bottom: 24px;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 24px;">‚ö†Ô∏è</span>
            <div>
              <div style="color: #f59e0b; font-weight: 600; margin-bottom: 4px;">Home Assistant Mode - Read Only</div>
              <div style="color: var(--text-muted); font-size: 14px;">
                Settings are managed through the Home Assistant addon configuration UI. These values are displayed for reference only.
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Sub-tabs - FIXED: Use orch-tab class -->
        <div class="orch-tabs">
          <button class="orch-tab active" data-settings-tab="general">General</button>
          <button class="orch-tab" data-settings-tab="llm">LLM & AI</button>
          <button class="orch-tab" data-settings-tab="personality">Personality</button>
          <button class="orch-tab" data-settings-tab="integrations">Integrations</button>
          <button class="orch-tab" data-settings-tab="communications">Communications</button>
          <button class="orch-tab" data-settings-tab="monitoring">Monitoring</button>
          <button class="orch-tab" data-settings-tab="push">Push Notifications</button>
          <button class="orch-tab" data-settings-tab="backup">Backup & Restore</button>
        </div>

        <!-- Panels Container -->
        <div class="settings-panels">
          
          <!-- GENERAL PANEL -->
          <div id="settings-general-panel" class="settings-panel orch-panel active">
            <div class="panel">
              <div class="panel-head">
                <h3>General Settings</h3>
              </div>
              
              <div style="padding: 20px;">
                <div class="form-group">
                  <label class="form-label">Bot Name</label>
                  <input type="text" id="set-bot-name" placeholder="Jarvis Prime">
                  <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                    Display name for the bot
                  </div>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Bot Icon</label>
                  <input type="text" id="set-bot-icon" placeholder="üß†">
                  <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                    Emoji icon for the bot
                  </div>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Jarvis App Name</label>
                  <input type="text" id="set-jarvis-app-name" placeholder="Jarvis">
                  <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                    Application name used in notifications
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-beautify-enabled" />
                    <label for="set-beautify-enabled">Enable message beautification</label>
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-beautify-inline-images" />
                    <label for="set-beautify-inline-images">Show inline images</label>
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-silent-repost" />
                    <label for="set-silent-repost">Silent repost mode</label>
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-greeting-enabled" />
                    <label for="set-greeting-enabled">Enable greeting messages</label>
                  </div>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Retention Days</label>
                  <input type="number" id="set-retention-days" min="1" placeholder="30">
                  <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                    Number of days to keep messages in inbox
                  </div>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Retention Hours (for hourly cleanup)</label>
                  <input type="number" id="set-retention-hours" min="1" placeholder="24">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Auto-Purge Policy</label>
                  <select id="set-auto-purge-policy">
                    <option value="off">Off</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                  </select>
                </div>
              </div>
            </div>
          </div>

          <!-- LLM & AI PANEL -->
          <div id="settings-llm-panel" class="settings-panel orch-panel">
            <div class="panel">
              <div class="panel-head">
                <h3>LLM & AI Configuration</h3>
              </div>
              
              <div style="padding: 20px;">
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-llm-enabled" />
                    <label for="set-llm-enabled">Enable LLM processing</label>
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-llm-persona-riffs-enabled" />
                    <label for="set-llm-persona-riffs-enabled">Enable persona riffs (personality-based responses)</label>
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-llm-rewrite-enabled" />
                    <label for="set-llm-rewrite-enabled">Enable message rewriting</label>
                  </div>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Models Directory</label>
                  <input type="text" id="set-llm-models-dir" placeholder="/share/jarvis_prime/models">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Timeout (seconds)</label>
                  <input type="number" id="set-llm-timeout-seconds" min="1" placeholder="20">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Max CPU Percent</label>
                  <input type="number" id="set-llm-max-cpu-percent" min="1" max="100" placeholder="80">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Context Tokens</label>
                  <input type="number" id="set-llm-ctx-tokens" min="128" placeholder="6096">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Generation Tokens</label>
                  <input type="number" id="set-llm-gen-tokens" min="32" placeholder="300">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Threads</label>
                  <input type="number" id="set-llm-threads" min="1" placeholder="3">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Models Priority (comma-separated)</label>
                  <input type="text" id="set-llm-models-priority" placeholder="phi35_q5_uncensored,phi35_q5,phi35_q4,phi3">
                  <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                    Order of preference for LLM models
                  </div>
                </div>
                
                <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">EnviroGuard Settings</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-llm-enviroguard-enabled" />
                      <label for="set-llm-enviroguard-enabled">Enable EnviroGuard (CPU temperature monitoring)</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Poll Interval (minutes)</label>
                    <input type="number" id="set-llm-enviroguard-poll-minutes" min="1" placeholder="30">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Hot Threshold (¬∞C)</label>
                    <input type="number" id="set-llm-enviroguard-hot-c" min="0" placeholder="30">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Normal Threshold (¬∞C)</label>
                    <input type="number" id="set-llm-enviroguard-normal-c" min="0" placeholder="22">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Cold Threshold (¬∞C)</label>
                    <input type="number" id="set-llm-enviroguard-cold-c" min="0" placeholder="10">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- PERSONALITY PANEL -->
          <div id="settings-personality-panel" class="settings-panel orch-panel">
            <div class="panel">
              <div class="panel-head">
                <h3>Personality & Chat Settings</h3>
              </div>
              
              <div style="padding: 20px;">
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-personality-enabled" />
                    <label for="set-personality-enabled">Enable personality system</label>
                  </div>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Active Persona</label>
                  <select id="set-active-persona">
                    <option value="auto">Auto (random selection)</option>
                    <option value="dude">Dude</option>
                    <option value="chick">Chick</option>
                    <option value="nerd">Nerd</option>
                    <option value="rager">Rager</option>
                    <option value="comedian">Comedian</option>
                    <option value="action">Action</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Minimum Interval Between Messages (minutes)</label>
                  <input type="number" id="set-personality-min-interval-minutes" min="1" placeholder="90">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Interval Jitter Percentage</label>
                  <input type="number" id="set-personality-interval-jitter-pct" min="0" max="100" placeholder="20">
                  <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                    Random variance to make timing less predictable
                  </div>
                </div>
                
                <div class="form-group">
                  <label class="form-label">Daily Maximum Messages</label>
                  <input type="number" id="set-personality-daily-max" min="1" placeholder="6">
                </div>
                
                <div class="form-group">
                  <label class="form-label">Quiet Hours</label>
                  <input type="text" id="set-personality-quiet-hours" placeholder="23:00-06:00">
                  <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">
                    Time range when personality messages are suppressed (24h format)
                  </div>
                </div>
                
                <div class="form-group">
                  <div class="checkbox-group">
                    <input type="checkbox" id="set-chat-enabled" />
                    <label for="set-chat-enabled">Enable chat interface</label>
                  </div>
                </div>
                
                <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Enabled Personas</h4>
                  <div style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">
                    Select which personas can be randomly chosen in auto mode
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-enable-dude" />
                      <label for="set-enable-dude">Dude</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-enable-chick" />
                      <label for="set-enable-chick">Chick</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-enable-nerd" />
                      <label for="set-enable-nerd">Nerd</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-enable-rager" />
                      <label for="set-enable-rager">Rager</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-enable-comedian" />
                      <label for="set-enable-comedian">Comedian</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-enable-action" />
                      <label for="set-enable-action">Action</label>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- INTEGRATIONS PANEL -->
          <div id="settings-integrations-panel" class="settings-panel orch-panel">
            <div class="panel">
              <div class="panel-head">
                <h3>Integrations & Modules</h3>
              </div>
              
              <div style="padding: 20px;">
                
                <!-- Weather Module -->
                <div style="margin-bottom: 32px;">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Weather Module</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-weather-enabled" />
                      <label for="set-weather-enabled">Enable weather reports</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Latitude</label>
                    <input type="number" step="0.0001" id="set-weather-lat" placeholder="-26.2041">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Longitude</label>
                    <input type="number" step="0.0001" id="set-weather-lon" placeholder="28.0473">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">City Name</label>
                    <input type="text" id="set-weather-city" placeholder="Odendaalsrus">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Daily Report Time</label>
                    <input type="time" id="set-weather-time">
                  </div>
                </div>
                
                <!-- Digest Module -->
                <div style="margin-bottom: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Daily Digest</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-digest-enabled" />
                      <label for="set-digest-enabled">Enable daily digest</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Digest Time</label>
                    <input type="time" id="set-digest-time">
                  </div>
                </div>
                
                <!-- Heartbeat Module -->
                <div style="margin-bottom: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Heartbeat</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-heartbeat-enabled" />
                      <label for="set-heartbeat-enabled">Enable heartbeat messages</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Interval (minutes)</label>
                    <input type="number" id="set-heartbeat-interval-minutes" min="1" placeholder="120">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Start Time</label>
                    <input type="time" id="set-heartbeat-start">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">End Time</label>
                    <input type="time" id="set-heartbeat-end">
                  </div>
                </div>
                
                <!-- Radarr -->
                <div style="margin-bottom: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Radarr Integration</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-radarr-enabled" />
                      <label for="set-radarr-enabled">Enable Radarr integration</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Radarr URL</label>
                    <input type="url" id="set-radarr-url" placeholder="http://localhost:7878">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="password" id="set-radarr-api-key" placeholder="Your Radarr API key">
                  </div>
                </div>
                
                <!-- Sonarr -->
                <div style="padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Sonarr Integration</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-sonarr-enabled" />
                      <label for="set-sonarr-enabled">Enable Sonarr integration</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Sonarr URL</label>
                    <input type="url" id="set-sonarr-url" placeholder="http://localhost:8989">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="password" id="set-sonarr-api-key" placeholder="Your Sonarr API key">
                  </div>
                </div>
                
              </div>
            </div>
          </div>
          
          <!-- COMMUNICATIONS PANEL -->
          <div id="settings-communications-panel" class="settings-panel orch-panel">
            <div class="panel">
              <div class="panel-head">
                <h3>Communications Settings</h3>
              </div>
              
              <div style="padding: 20px;">
                
                <!-- SMTP -->
                <div style="margin-bottom: 32px;">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">SMTP Intake Server</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-smtp-enabled" />
                      <label for="set-smtp-enabled">Enable SMTP intake server</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">SMTP Port</label>
                    <input type="number" id="set-smtp-port" min="1" max="65535" placeholder="2525">
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-ingest-smtp-enabled" />
                      <label for="set-ingest-smtp-enabled">Process incoming SMTP messages</label>
                    </div>
                  </div>
                </div>
                
                <!-- Proxy -->
                <div style="margin-bottom: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Proxy Server</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-proxy-enabled" />
                      <label for="set-proxy-enabled">Enable proxy server</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Proxy Port</label>
                    <input type="number" id="set-proxy-port" min="1" max="65535" placeholder="2580">
                  </div>
                </div>
                
                <!-- Webhook -->
                <div style="margin-bottom: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Webhook Server</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-webhook-enabled" />
                      <label for="set-webhook-enabled">Enable webhook server</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Webhook Port</label>
                    <input type="number" id="set-webhook-port" min="1" max="65535" placeholder="2590">
                  </div>
                </div>
                
                <!-- Apprise -->
                <div style="padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Apprise Integration</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-intake-apprise-enabled" />
                      <label for="set-intake-apprise-enabled">Enable Apprise intake</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Apprise Port</label>
                    <input type="number" id="set-intake-apprise-port" min="1" max="65535" placeholder="2591">
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-ingest-apprise-enabled" />
                      <label for="set-ingest-apprise-enabled">Process incoming Apprise messages</label>
                    </div>
                  </div>
                </div>
                
              </div>
            </div>
          </div>

          <!-- MONITORING PANEL -->
          <div id="settings-monitoring-panel" class="settings-panel orch-panel">
            <div class="panel">
              <div class="panel-head">
                <h3>Monitoring Integration</h3>
              </div>
              
              <div style="padding: 20px;">
                
                <!-- Uptime Kuma -->
                <div style="margin-bottom: 32px;">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Uptime Kuma</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-uptimekuma-enabled" />
                      <label for="set-uptimekuma-enabled">Enable Uptime Kuma integration</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Uptime Kuma URL</label>
                    <input type="url" id="set-uptimekuma-url" placeholder="http://localhost:3001">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="password" id="set-uptimekuma-api-key" placeholder="Your Uptime Kuma API key">
                  </div>
                </div>
                
                <!-- Technitium DNS -->
                <div style="padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Technitium DNS</h4>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-technitium-enabled" />
                      <label for="set-technitium-enabled">Enable Technitium DNS integration</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Technitium URL</label>
                    <input type="url" id="set-technitium-url" placeholder="http://localhost:5380">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">API Key</label>
                    <input type="password" id="set-technitium-api-key" placeholder="Your Technitium API key">
                  </div>
                </div>
                
              </div>
            </div>
          </div>

          <!-- PUSH NOTIFICATIONS PANEL -->
          <div id="settings-push-panel" class="settings-panel orch-panel">
            <div class="panel">
              <div class="panel-head">
                <h3>Push Notifications</h3>
              </div>
              
              <div style="padding: 20px;">
                
                <!-- Gotify -->
                <div style="margin-bottom: 32px;">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">Gotify</h4>
                  
                  <div class="form-group">
                    <label class="form-label">Gotify URL</label>
                    <input type="url" id="set-gotify-url" placeholder="http://localhost:8080">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Client Token</label>
                    <input type="password" id="set-gotify-client-token" placeholder="Client token for receiving messages">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">App Token</label>
                    <input type="password" id="set-gotify-app-token" placeholder="App token for sending messages">
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-push-gotify-enabled" />
                      <label for="set-push-gotify-enabled">Enable Gotify push notifications</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-ingest-gotify-enabled" />
                      <label for="set-ingest-gotify-enabled">Process incoming Gotify messages</label>
                    </div>
                  </div>
                </div>
                
                <!-- ntfy -->
                <div style="padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 16px 0; color: var(--text-primary);">ntfy</h4>
                  
                  <div class="form-group">
                    <label class="form-label">ntfy URL</label>
                    <input type="url" id="set-ntfy-url" placeholder="https://ntfy.sh">
                  </div>
                  
                  <div class="form-group">
                    <label class="form-label">Topic</label>
                    <input type="text" id="set-ntfy-topic" placeholder="jarvis-notifications">
                  </div>
                  
                  <div class="form-group">
                    <div class="checkbox-group">
                      <input type="checkbox" id="set-push-ntfy-enabled" />
                      <label for="set-push-ntfy-enabled">Enable ntfy push notifications</label>
                    </div>
                  </div>
                </div>
                
              </div>
            </div>
          </div>
          
          <!-- BACKUP & RESTORE PANEL -->
          <div id="settings-backup-panel" class="settings-panel orch-panel">
            <div class="panel">
              <div class="panel-head">
                <h3>Backup & Restore</h3>
              </div>
              
              <div style="padding: 20px;">
                
                <!-- Info Banner -->
                <div style="background: rgba(14, 165, 233, 0.1); border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 8px; padding: 16px; margin-bottom: 24px;">
                  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                    <span style="font-size: 24px;">üíæ</span>
                    <span style="color: #0ea5e9; font-weight: 600;">Full System Backup</span>
                  </div>
                  <p style="color: var(--text-muted); font-size: 13px; margin-bottom: 0;">
                    Create a complete backup of your Jarvis Prime installation including database, playbooks, models, and configuration. Works on both Docker and Home Assistant deployments.
                  </p>
                </div>
                
                <!-- Download Backup -->
                <div style="margin-bottom: 32px;">
                  <h4 style="margin: 0 0 12px 0; color: var(--text-primary);">Create Backup</h4>
                  <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">
                    Download a complete backup archive (.tar.gz) containing:
                  </p>
                  <ul style="font-size: 13px; color: var(--text-muted); margin: 0 0 16px 20px; line-height: 1.6;">
                    <li>SQLite database (messages, orchestrations, analytics)</li>
                    <li>Playbooks directory</li>
                    <li>LLM models directory</li>
                    <li>Configuration files</li>
                  </ul>
                  
                  <button id="backup-download-btn" class="btn btn-primary" style="width: 100%;">
                    üì• Download Full Backup
                  </button>
                </div>
                
                <!-- Restore Backup -->
                <div style="padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 12px 0; color: var(--text-primary);">Restore Backup</h4>
                  <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 16px;">
                    Upload a backup archive to restore your Jarvis Prime configuration and data. 
                    <strong style="color: var(--accent);">This will overwrite all current data.</strong>
                  </p>
                  
                  <div style="background: rgba(245, 158, 11, 0.15); border: 1px solid rgba(245, 158, 11, 0.4); border-radius: 6px; padding: 12px; margin-bottom: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                      <span style="font-size: 18px;">‚ö†Ô∏è</span>
                      <span style="color: #f59e0b; font-size: 13px; font-weight: 500;">
                        Jarvis will automatically restart after restore completes
                      </span>
                    </div>
                  </div>
                  
                  <input type="file" id="backup-file-input" accept=".tar.gz,.tgz" style="display: none;">
                  <button id="backup-restore-btn" class="btn" style="width: 100%;">
                    üì§ Select Backup File to Restore
                  </button>
                </div>
                
                <!-- Backup Info -->
                <div style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border);">
                  <h4 style="margin: 0 0 12px 0; color: var(--text-primary);">üí° Backup Best Practices</h4>
                  <ul style="font-size: 13px; color: var(--text-muted); margin: 0 0 0 20px; line-height: 1.8;">
                    <li>Create regular backups before making configuration changes</li>
                    <li>Store backups in a safe location outside the Jarvis system</li>
                    <li>Test your backups periodically to ensure they can be restored</li>
                    <li>Backups are compatible between Docker and Home Assistant deployments</li>
                    <li>Large LLM models may result in large backup files (>1GB)</li>
                  </ul>
                </div>
                
              </div>
            </div>
          </div>

        </div>
        <!-- End of .settings-panels -->
        
        <!-- Save Button (only visible in Docker mode) -->
        <div style="margin-top: 24px;">
          <button id="settings-save-btn" class="btn btn-primary" style="width: 100%;">
            üíæ Save All Settings
          </button>
          <div style="font-size: 12px; color: var(--text-muted); text-align: center; margin-top: 8px;">
            Settings will be saved to config file. Some changes may require restart.
          </div>
        </div>

      </section>
      <!-- End of Settings Section -->
      
      </main>
  </div>

  <!-- Toast Notification Container -->
  <div id="toast-container"></div>

  <!-- Scripts -->
  <script>
    // API helper
    window.API = (endpoint) => {
      const base = window.location.origin;
      return `${base}/${endpoint}`;
    };

    // Toast notification system
    window.showToast = (message, type = 'info') => {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.add('show');
      }, 10);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => {
          container.removeChild(toast);
        }, 300);
      }, 3000);
    };

    // Tab Navigation
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const targetTab = tab.dataset.tab;
        
        // Update active nav tab
        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active panel
        document.querySelectorAll('.tab-panel').forEach(panel => {
          panel.classList.remove('active');
        });
        document.getElementById(targetTab).classList.add('active');
      });
    });

    // Orchestrator sub-tab navigation
    document.querySelectorAll('[data-orch-tab]').forEach(tab => {
      tab.addEventListener('click', () => {
        const targetPanel = tab.dataset.orchTab;
        
        // Update active tab
        document.querySelectorAll('[data-orch-tab]').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active panel
        document.querySelectorAll('.orch-panel').forEach(panel => {
          panel.classList.remove('active');
        });
        document.getElementById(`orch-${targetPanel}-panel`).classList.add('active');
      });
    });

    // Analytics sub-tab navigation
    document.querySelectorAll('[data-analytics-tab]').forEach(tab => {
      tab.addEventListener('click', () => {
        const targetPanel = tab.dataset.analyticsTab;
        
        // Update active tab
        document.querySelectorAll('[data-analytics-tab]').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Update active panel
        document.querySelectorAll('#analytics .orch-panel').forEach(panel => {
          panel.classList.remove('active');
        });
        document.getElementById(`analytics-${targetPanel}-panel`).classList.add('active');
      });
    });
  </script>

  <!-- Module Scripts -->
  <script src="/static/js/inbox.js"></script>
  <script src="/static/js/chat.js"></script>
  <script src="/static/js/orchestrator.js"></script>
  <script src="/static/js/analytics.js"></script>
  <script src="/static/js/settings.js"></script>

  </body>
</html>

<!-- 
  ========================================
  END OF COMPLETE index.html FILE
  ========================================
  
  This is the final part.
  
  To assemble the complete file:
  1. Copy Part 1
  2. Append Part 2
  3. Append Part 3
  4. Append Part 4
  5. Append Part 5
  6. Append Part 6
  7. Append Part 7
  8. Append Part 8 (includes BACKUP panel)
  9. Append Part 9
  10. Append Part 10 (this part)
  
  Save as index.html
-->

<!-- END OF PART 10 -->
