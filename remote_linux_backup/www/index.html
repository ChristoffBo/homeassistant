<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Remote Linux Backup</title>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <nav class="tabs" id="tabs">
    <a class="tab-btn" href="#tab-backup" data-tab="tab-backup" title="Create a new backup">Backup</a>
    <a class="tab-btn" href="#tab-restore" data-tab="tab-restore" title="Restore a backup to a device or folder">Restore</a>
    <a class="tab-btn" href="#tab-connections" data-tab="tab-connections" title="Saved SSH hosts for rsync/image">Connections</a>
    <a class="tab-btn" href="#tab-mounts" data-tab="tab-mounts" title="SMB/NFS network shares">Mounts</a>
    <a class="tab-btn" href="#tab-backups" data-tab="tab-backups" title="List, download, verify and delete backups">Backups</a>
    <a class="tab-btn" href="#tab-schedule" data-tab="tab-schedule" title="Run backups automatically">Schedule</a>
    <a class="tab-btn" href="#tab-notifications" data-tab="tab-notifications" title="Gotify notifications and system update">Notifications</a>
    <a class="tab-btn" href="#tab-help" data-tab="tab-help" title="How to use + disaster recovery">Help</a>
  </nav>
</header>

<main id="content">
  <!-- BACKUP -->
  <section id="tab-backup" class="tab-panel default">
    <div class="card">
      <h2>Backup</h2>
      <p class="muted">Make a safe copy of files/folders (rsync/copy) or create a full disk image (dd). Complete the steps below from left to right.</p>

      <div class="explainer">
        <div class="step" id="step-source">1. Pick source</div>
        <div class="step" id="step-mode">2. Choose mode</div>
        <div class="step" id="step-destination">3. Choose destination</div>
        <div class="step" id="step-run">4. Start</div>
      </div>

      <div class="grid-3">
        <div class="field">
          <label>Dry run</label>
          <select id="b_dry"><option>No</option><option>Yes</option></select>
        </div>
        <div class="field">
          <label>Connection <span class="hint">(saved)</span></label>
          <select id="b_conn" title="Pick a saved SSH connection from the Connections tab"></select>
          <button id="b_conn_use" class="small secondary" type="button" title="Fill host/user/pass from this saved connection">Use</button>
        </div>
        <div class="field">
          <label>Source type</label>
          <select id="b_src_type">
            <option value="ssh">SSH (remote)</option>
            <option value="local">Local path (this HA)</option>
            <option value="mount">Mount (SMB/NFS)</option>
          </select>
        </div>

        <div class="field">
          <label>Hostname / IP</label>
          <input id="b_host" placeholder="e.g. 10.0.0.21">
        </div>
        <div class="field">
          <label>Username</label>
          <input id="b_user" value="root">
        </div>
        <div class="field">
          <label>Password</label>
          <input id="b_pass" type="password">
        </div>

        <div class="field">
          <label>Mode</label>
          <select id="b_mode">
            <option value="rsync">Rsync (SSH) — Files & folders</option>
            <option value="copy_local">Copy (local) — Files & folders</option>
            <option value="copy_mount">Copy (mount) — SMB/NFS</option>
            <option value="image">Image (dd) — Full disk</option>
          </select>
        </div>
        <div class="field">
          <label>Label (optional)</label>
          <input id="b_label" placeholder="e.g. after-upgrade">
        </div>
        <div class="field">
          <label>Max MB/s</label>
          <input id="b_bwlimit" type="number" min="0" value="0" title="0 = unlimited">
          <input id="b_bw_slider" type="range" min="0" max="200" step="1" value="0">
          <small>0 = unlimited • quick picks: 1, 2, 5, 10, 20, 50, 100</small>
        </div>
      </div>

      <div class="card subtle">
        <h3>Destination</h3>
        <div class="grid-3">
          <div class="field">
            <label>Store backup to</label>
            <select id="dest_type">
              <option value="local">Local (this HA)</option>
              <option value="mount">Mount (SMB/NFS)</option>
            </select>
          </div>
          <div class="field">
            <label>Destination mount</label>
            <select id="dest_mount"></select>
          </div>
          <div class="field">
            <label>Destination subfolder (optional)</label>
            <input id="dest_subdir" placeholder="e.g. backups/servers/proxmox">
          </div>
        </div>
      </div>

      <div class="grid-3" id="rsync-row">
        <div class="field">
          <label>Source folder / device</label>
          <input id="b_src" value="/" placeholder="/path or /dev/sdX">
          <div class="actions">
            <button type="button" id="b_browse" class="secondary" title="Browse over SSH">Browse (SSH)</button>
            <button type="button" id="b_pick_local" class="secondary" title="Pick local path on this HA">Pick local</button>
            <button type="button" id="b_pick_mount" class="secondary" title="Pick path from a saved mount">Pick from mount</button>
            <button type="button" id="b_test" class="secondary" title="Test SSH connection">Test SSH</button>
          </div>
        </div>
        <div class="field">
          <label>Estimate</label>
          <button id="b_estimate" type="button" class="secondary" title="Estimate total size to transfer">Estimate size</button>
        </div>
        <div class="field">
          <label>&nbsp;</label>
          <div class="muted" id="dest_info">Backups are stored under <code>/config/remote_linux_backup/backups/</code>.</div>
        </div>
      </div>

      <div class="actions">
        <button id="b_start" class="primary" title="Start the selected backup">Start</button>
        <button id="b_cancel" class="danger" title="Cancel the currently running job">Cancel Job</button>
      </div>

      <div class="progress-row">
        <label>Progress:</label>
        <progress id="b_progress" value="0" max="100"></progress>
        <span id="b_progress_pct">0%</span>
      </div>
      <pre class="log" id="log"></pre>
    </div>
  </section>

  <!-- RESTORE -->
  <section id="tab-restore" class="tab-panel">
    <div class="card"><h2>Restore</h2><p class="muted">Pick a backup and restore it to a folder (rsync) or device (dd).</p></div>
  </section>

  <!-- CONNECTIONS -->
  <section id="tab-connections" class="tab-panel">
    <div class="card">
      <h2>Connections</h2>
      <div class="grid-4">
        <div class="field"><label>Name</label><input id="c_name"></div>
        <div class="field"><label>Host</label><input id="c_host"></div>
        <div class="field"><label>Port</label><input id="c_port" type="number" value="22"></div>
        <div class="field"><label>Username</label><input id="c_user" value="root"></div>
        <div class="field"><label>Password</label><input id="c_pass" type="password"></div>
      </div>
      <div class="actions">
        <button id="c_save" class="primary" title="Save this connection">Save</button>
        <button id="c_refresh" class="secondary" title="Refresh list">Refresh</button>
        <button id="c_test" class="secondary" title="Test SSH to host">Test</button>
      </div>
      <table class="table" id="c_table">
        <thead><tr><th>Name</th><th>Host</th><th>Port</th><th>User</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- MOUNTS -->
  <section id="tab-mounts" class="tab-panel">
    <div class="card">
      <h2>Mounts</h2>
      <div class="grid-4">
        <div class="field"><label>Name</label><input id="m_name" placeholder="e.g. NAS1"></div>
        <div class="field"><label>Type</label><select id="m_type"><option value="smb">SMB</option><option value="nfs">NFS</option></select></div>
        <div class="field"><label>Host</label><input id="m_host" placeholder="10.0.0.21"></div>
        <div class="field"><label>Share/Export</label><input id="m_share" placeholder="For SMB: share | For NFS: /export"></div>
        <div class="field"><label>Username</label><input id="m_user"></div>
        <div class="field"><label>Password</label><input id="m_pass" type="password"></div>
        <div class="field"><label>Options</label><input id="m_opts" placeholder="e.g. ro,vers=3"></div>
        <div class="field"><label>Auto-retry</label><select id="m_retry"><option value="1">Yes</option><option value="0">No</option></select></div>
      </div>
      <div class="actions">
        <button id="m_scan" class="secondary" type="button" title="Discover SMB/NFS servers on your LAN">Scan network</button>
        <button id="m_connect" class="secondary" type="button" title="Query shares/exports on host">Connect</button>
        <button id="m_pick_share" class="secondary" type="button" title="Choose from the discovered list">Pick share</button>
        <button id="m_test" class="secondary" type="button" title="Verify credentials and access">Test SMB/NFS</button>
        <button id="m_save" class="primary" type="button" title="Save mount">Save</button>
        <button id="m_refresh" class="secondary" type="button" title="Refresh table">Refresh</button>
      </div>
      <table class="table" id="m_table">
        <thead><tr><th>Name</th><th>Type</th><th>Host</th><th>Share/Export</th><th>Status</th><th>Mountpoint</th><th>Last error</th><th>Actions</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- BACKUPS -->
  <section id="tab-backups" class="tab-panel">
    <div class="card"><h2>Backups</h2><p class="muted">List, download, verify and delete backups.</p>
      <table class="table" id="bk_table"><thead><tr><th>Label</th><th>Date</th><th>Type</th><th>Size</th><th>Location</th><th>Actions</th></tr></thead><tbody></tbody></table>
    </div>
  </section>

  <!-- SCHEDULE -->
  <section id="tab-schedule" class="tab-panel">
    <div class="card">
      <h2>Schedule</h2>
      <div class="grid-3">
        <div class="field"><label>Max concurrent jobs</label><input id="j_max" type="number" min="1" value="1"></div>
        <div class="field"><label>Default bwlimit (KB/s)</label><input id="j_bw" type="number" min="0" value="0"></div>
      </div>
    </div>
    <div class="card">
      <h3>Create / Update Schedule</h3>
      <div class="grid-4">
        <div class="field"><label>Name</label><input id="sch_name"></div>
        <div class="field"><label>Frequency</label><select id="sch_freq"><option value="daily">Daily</option><option value="weekly">Weekly</option><option value="monthly">Monthly</option></select></div>
        <div class="field"><label>Time (HH:MM)</label><input id="sch_time" value="02:00"></div>
        <div class="field"><label>Day (Sun=0..Sat=6 or 1..28)</label><input id="sch_day"></div>
      </div>
      <div class="grid-4">
        <div class="field"><label>Mode</label><select id="sch_mode"><option value="rsync">Rsync (SSH)</option><option value="image">Image (dd)</option><option value="copy_local">Copy (local)</option><option value="copy_mount">Copy (mount)</option></select></div>
        <div class="field"><label>Label</label><input id="sch_label"></div>
        <div class="field"><label>BW limit (KB/s)</label><input id="sch_bw" type="number" value="0"></div>
        <div class="field"><label>Enabled</label><select id="sch_enabled"><option value="1">Yes</option><option value="0">No</option></select></div>
      </div>
      <div class="grid-4">
        <div class="field"><label>Host</label><input id="sch_host"></div>
        <div class="field"><label>Port</label><input id="sch_port" type="number" value="22"></div>
        <div class="field"><label>User</label><input id="sch_user"></div>
        <div class="field"><label>Password</label><input id="sch_pass" type="password"></div>
        <div class="field"><label>Source path / Device</label><input id="sch_src"></div>
        <div class="field"><label>Mount name (for copy_mount)</label><input id="sch_mount"></div>
        <div class="field"><label>Destination: type</label><select id="sch_dest_type"><option value="local">Local</option><option value="mount">Mount</option></select></div>
        <div class="field"><label>Destination: mount name</label><input id="sch_dest_mount"></div>
        <div class="field"><label>Destination: subfolder</label><input id="sch_dest_subdir"></div>
      </div>
      <div class="actions">
        <button id="sch_add" class="primary">Save schedule</button>
        <button id="sch_clear_form" class="secondary">Clear</button>
      </div>
    </div>
    <div class="card">
      <h3>Schedules</h3>
      <table class="table" id="sch_table"><thead><tr><th>Name</th><th>Freq</th><th>Time</th><th>Next run</th><th>Template</th><th>Enabled</th><th>Actions</th></tr></thead><tbody></tbody></table>
    </div>
  </section>

  <!-- NOTIFICATIONS -->
  <section id="tab-notifications" class="tab-panel">
    <div class="card">
      <h2>Notifications</h2>
      <div class="grid-4">
        <div class="field"><label>Enabled</label><select id="n_enabled"><option value="1">Yes</option><option value="0">No</option></select></div>
        <div class="field"><label>Gotify URL</label><input id="n_url" placeholder="https://gotify.example.com"></div>
        <div class="field"><label>Token</label><input id="n_token"></div>
        <div class="field"><label>Priority</label><input id="n_priority" type="number" value="5"></div>
      </div>
      <div class="actions">
        <button id="n_save" class="primary">Save</button>
        <button id="n_test" class="secondary">Send test</button>
        <button id="sys_apt" class="secondary">System Update (apt)</button>
      </div>
      <pre id="sys_log" class="log"></pre>
    </div>
  </section>

  <!-- HELP -->
  <section id="tab-help" class="tab-panel">
    <div class="card"><h2>Help</h2><p>Each tab explains itself. If this UI breaks, you can still restore manually by copying from <code>/config/remote_linux_backup/backups/</code>.</p></div>
  </section>

  <!-- Picker Modal -->
  <div id="picker-modal" class="modal hidden">
    <div class="modal-card">
      <div class="modal-head">
        <div class="crumbs" id="picker-path">/</div>
        <button id="picker-close" class="secondary small">Close</button>
      </div>
      <div class="modal-body">
        <table class="table" id="picker-table"><thead><tr><th>Name</th><th>Type</th><th>Size</th></tr></thead><tbody></tbody></table>
      </div>
      <div class="modal-foot"><button id="picker-up" class="secondary">Up</button><button id="picker-select" class="primary">Select</button></div>
    </div>
  </div>

  <!-- Network Scan Modal -->
  <div id="scan-modal" class="modal hidden">
    <div class="modal-card" style="min-width:70%">
      <div class="modal-head">
        <div><strong>Network scan</strong><div class="muted">Discover SMB/NFS servers and shares on your LAN</div></div>
        <button id="scan-close" class="secondary small">Close</button>
      </div>
      <div class="modal-body">
        <div class="grid-4">
          <div class="field"><label>Subnet</label><select id="scan-subnet"></select></div>
          <div class="field"><label>Types</label><select id="scan-types" multiple><option value="smb" selected>SMB</option><option value="nfs" selected>NFS</option></select></div>
          <div class="field"><label>&nbsp;</label><button id="scan-start" class="primary" type="button">Start scan</button></div>
          <div class="field"><label>Status</label><input id="scan-status" readonly></div>
        </div>
        <table class="table" id="scan-table"><thead><tr><th>IP</th><th>SMB shares</th><th>NFS exports</th><th>Action</th></tr></thead><tbody></tbody></table>
      </div>
    </div>
  </div>
</main>

<script src="app.js" defer></script>
</body>
</html>
