<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Remote Linux Backup</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="topbar">
    <nav class="tabs" id="tabs">
      <button class="tab-btn active" data-tab="tab-backup">Backup</button>
      <button class="tab-btn" data-tab="tab-restore">Restore</button>
      <button class="tab-btn" data-tab="tab-connections">Connections</button>
      <button class="tab-btn" data-tab="tab-mounts">Mounts</button>
      <button class="tab-btn" data-tab="tab-backups">Backups</button>
      <button class="tab-btn" data-tab="tab-schedule">Schedule</button>
      <button class="tab-btn" data-tab="tab-notifications">Notifications</button>
      <button class="tab-btn" data-tab="tab-help">Help</button>
    </nav>
  </header>

  <main class="container">
    <!-- Backup -->
    <section id="tab-backup" class="tab-panel active">
      <div class="card">
        <h2>Backup</h2>
        <p class="muted">Make a safe copy of files/folders (rsync) or create a full disk image (dd). Choose a saved connection or enter host details, then pick a source path or a device.</p>
        <form id="backup-form">
          <div class="grid-3">
            <div class="field">
              <label>Dry run</label>
              <select id="b_dryrun">
                <option value="0">No</option>
                <option value="1">Yes</option>
              </select>
            </div>
            <div class="field">
              <label>Connection</label>
              <select id="b_conn"></select>
            </div>
            <div class="field">
              <label>Source Type</label>
              <select id="b_source_type">
                <option value="ssh">SSH (remote)</option>
                <option value="mount">Mount (SMB/NFS)</option>
              </select>
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label>Hostname / IP</label>
              <input id="b_host" placeholder="e.g. 10.0.0.10">
            </div>
            <div class="field">
              <label>Username</label>
              <input id="b_user" placeholder="root">
            </div>
            <div class="field">
              <label>Password</label>
              <input id="b_pass" type="password" placeholder="••••••••">
            </div>
          </div>

          <div class="grid-3">
            <div class="field">
              <label>Mode</label>
              <select id="b_mode">
                <option value="rsync">Copy (rsync) — Files & folders</option>
                <option value="image">Image (dd) — Full disk</option>
                <option value="copy_local">Copy (local) — This HA host path</option>
                <option value="copy_mount">Copy (mount) — SMB/NFS</option>
              </select>
            </div>
            <div class="field">
              <label>Label (optional)</label>
              <input id="b_label" placeholder="e.g. after-upgrade">
            </div>
            <div class="field">
              <label>Max MB/s (optional)</label>
              <input id="b_bwlimit" type="number" min="0" value="0">
              <small>0 = unlimited</small>
            </div>
          </div>

          <div class="grid-3" id="rsync-row">
            <div class="field">
              <label>Source folder (file picker)</label>
              <input id="b_src" value="/" placeholder="/path/on/remote">
              <button type="button" id="b_browse" class="secondary">Browse</button>
              <small>Pick the folder you want to back up. This uses SFTP over SSH.</small>
            </div>
            <div class="field"></div>
            <div class="field">
              <label>&nbsp;</label>
              <button type="button" id="b_estimate" class="secondary">Estimate size</button>
            </div>
          </div>

          <div class="grid-3 hidden" id="image-row">
            <div class="field">
              <label>Block device (remote)</label>
              <input id="b_device" placeholder="/dev/sda">
            </div>
            <div class="field">
              <label>Encrypt image</label>
              <select id="b_encrypt">
                <option value="0">No</option>
                <option value="1">Yes (AES-256)</option>
              </select>
            </div>
            <div class="field">
              <label>Passphrase</label>
              <input id="b_passphrase" type="password" placeholder="required if encrypting">
            </div>
          </div>

          <div class="actions">
            <button type="button" id="b_start" class="primary">Start</button>
            <button type="button" id="b_cancel" class="danger">Cancel Job</button>
          </div>

          <div class="progress-wrap">
            <label>Progress:</label>
            <progress id="b_progress" max="100" value="0"></progress>
            <span id="b_progress_pct">0%</span>
          </div>

          <pre id="log" class="log"></pre>
        </form>
      </div>
    </section>

    <!-- Restore -->
    <section id="tab-restore" class="tab-panel">
      <div class="card">
        <h2>Restore</h2>
        <div class="grid-3">
          <div class="field">
            <label>Mode</label>
            <select id="r_mode">
              <option value="rsync">Copy back (rsync)</option>
              <option value="image">Image restore (dd)</option>
            </select>
          </div>
          <div class="field">
            <label>Hostname / IP</label>
            <input id="r_host" placeholder="e.g. 10.0.0.10">
          </div>
          <div class="field">
            <label>Username / Password</label>
            <div class="inline">
              <input id="r_user" placeholder="root">
              <input id="r_pass" type="password" placeholder="••••••••">
            </div>
          </div>
        </div>
        <div class="grid-3" id="r-row-rsync">
          <div class="field">
            <label>Source folder (local backup)</label>
            <input id="r_src" placeholder="/config/remote_linux_backup/backups/...">
            <button type="button" id="r_pick_src" class="secondary">Pick</button>
          </div>
          <div class="field">
            <label>Remote destination path</label>
            <input id="r_dest" value="/" placeholder="/">
          </div>
          <div class="field">
            <label>Dry run</label>
            <select id="r_dry">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
        </div>
        <div class="grid-3 hidden" id="r-row-image">
          <div class="field">
            <label>Image file (local)</label>
            <input id="r_img" placeholder="/path/to/image.img.gz or .enc">
            <button type="button" id="r_pick_img" class="secondary">Pick</button>
          </div>
          <div class="field">
            <label>Remote device</label>
            <input id="r_dev" placeholder="/dev/sda">
          </div>
          <div class="field">
            <label>Confirm (type hostname)</label>
            <input id="r_confirm" placeholder="hostname from meta">
            <small class="muted">Required for safety. Device size is checked.</small>
          </div>
        </div>
        <div class="actions">
          <button type="button" id="r_start" class="primary">Start restore</button>
        </div>
        <pre id="r_log" class="log"></pre>
      </div>
    </section>

    <!-- Connections -->
    <section id="tab-connections" class="tab-panel">
      <div class="card">
        <h2>Connections</h2>
        <div class="grid-4">
          <div class="field"><label>Name</label><input id="c_name"></div>
          <div class="field"><label>Host</label><input id="c_host"></div>
          <div class="field"><label>Port</label><input id="c_port" type="number" value="22"></div>
          <div class="field"><label>Username</label><input id="c_user" value="root"></div>
          <div class="field"><label>Password</label><input id="c_pass" type="password"></div>
        </div>
        <div class="actions">
          <button id="c_save" class="primary" type="button">Save</button>
          <button id="c_refresh" class="secondary" type="button">Refresh</button>
        </div>
        <table class="table" id="c_table">
          <thead><tr><th>Name</th><th>Host</th><th>Port</th><th>User</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Mounts -->
    <section id="tab-mounts" class="tab-panel">
      <div class="card">
        <h2>Mounts</h2>
        <div class="grid-4">
          <div class="field"><label>Name</label><input id="m_name"></div>
          <div class="field"><label>Type</label><select id="m_type"><option value="smb">SMB</option><option value="nfs">NFS</option></select></div>
          <div class="field"><label>Host</label><input id="m_host"></div>
          <div class="field"><label>Share/Export</label><input id="m_share"></div>
          <div class="field"><label>Username</label><input id="m_user"></div>
          <div class="field"><label>Password</label><input id="m_pass" type="password"></div>
          <div class="field"><label>Options</label><input id="m_opts" placeholder="ro,vers=3"></div>
          <div class="field"><label>Auto-retry</label><select id="m_retry"><option value="1">Yes</option><option value="0">No</option></select></div>
        </div>
        <div class="actions">
          <button id="m_save" class="primary" type="button">Save</button>
          <button id="m_refresh" class="secondary" type="button">Refresh</button>
        </div>
        <table class="table" id="m_table">
          <thead><tr><th>Name</th><th>Type</th><th>Host</th><th>Share/Export</th><th>Status</th><th>Mountpoint</th><th>Last error</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Backups -->
    <section id="tab-backups" class="tab-panel">
      <div class="card">
        <h2>Backups</h2>
        <div class="grid-3">
          <div class="field"><label>Filter</label><input id="b_search"></div>
          <div class="field"><label>Group</label><select id="b_group"></select></div>
          <div class="field actions-right">
            <button id="b_refresh" class="secondary" type="button">Refresh</button>
            <button id="b_export_settings" class="secondary" type="button">Export settings</button>
            <button id="b_download_logs" class="secondary" type="button">Download logs</button>
            <label class="btnlike secondary">Upload<input type="file" id="b_upload" hidden></label>
          </div>
        </div>
        <table class="table" id="b_table">
          <thead><tr><th>Rel path</th><th>Dir?</th><th>Size</th><th>Modified</th><th>Action</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Schedule -->
    <section id="tab-schedule" class="tab-panel">
      <div class="card">
        <h2>Schedule</h2>
        <div class="grid-3">
          <div class="field">
            <label>Max concurrent jobs</label>
            <input id="j_max" type="number" min="1" value="1">
          </div>
          <div class="field">
            <label>Default bwlimit (KB/s)</label>
            <input id="j_bw" type="number" min="0" value="0">
          </div>
          <div class="field actions">
            <button id="j_save" class="primary" type="button">Save</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Notifications -->
    <section id="tab-notifications" class="tab-panel">
      <div class="card">
        <h2>Notifications</h2>
        <p class="muted">Gotify settings are in add-on options. Logs can be downloaded from Backups tab.</p>
        <div class="actions">
          <button id="sys_apt" class="secondary" type="button">System Update (apt)</button>
        </div>
        <pre id="sys_log" class="log"></pre>
      </div>
    </section>

    <!-- Help -->
    <section id="tab-help" class="tab-panel">
      <div class="card">
        <h2>Help</h2>
        <p>Each tab describes what it does. Backups are always restorable even without this UI. For image restores, you must confirm by typing the hostname saved in the image metadata to avoid mistakes.</p>
      </div>
    </section>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script src="app.js"></script>
</body>
</html>
