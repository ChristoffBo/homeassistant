<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Remote Linux Backup</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <nav class="tabs" id="tabs">
    <a class="tab-btn" href="#backup">Backup</a>
    <a class="tab-btn" href="#restore">Restore</a>
    <a class="tab-btn" href="#connections">Connections</a>
    <a class="tab-btn" href="#mounts">Mounts</a>
    <a class="tab-btn" href="#backups">Backups</a>
    <a class="tab-btn" href="#schedule">Schedule</a>
    <a class="tab-btn" href="#notifications">Notifications</a>
    <a class="tab-btn" href="#help">Help</a>
  </nav>
</header>
<main>
<section id="backup" class="panel">
  <div class="card">
    <h2>Backup (Wizard)</h2>
    <div class="wizard">
      <div class="step active" data-step="1">1. Source</div>
      <div class="step" data-step="2">2. Mode</div>
      <div class="step" data-step="3">3. Destination</div>
      <div class="step" data-step="4">4. Run</div>
    </div>
    <div class="grid-3">
      <div class="field"><label>Source type</label>
        <select id="b_src_type"><option value="ssh">SSH (remote)</option><option value="local">Local path</option><option value="mount">Mount (SMB/NFS)</option></select>
      </div>
      <div class="field"><label>Hostname / IP</label><input id="b_host" placeholder="10.0.0.21"></div>
      <div class="field"><label>Username</label><input id="b_user" value="root"></div>
      <div class="field"><label>Password</label><input id="b_pass" type="password"></div>
      <div class="field"><label>Mode</label>
        <select id="b_mode"><option value="rsync">Rsync (SSH) — files</option><option value="copy_local">Copy (local)</option><option value="copy_mount">Copy (mount)</option><option value="image">Image (dd) — disk</option></select>
      </div>
      <div class="field"><label>Label</label><input id="b_label" placeholder="after-upgrade"></div>
      <div class="field"><label>BW limit (KB/s)</label><input id="b_bw" type="number" value="0"></div>
      <div class="field"><label>Destination</label>
        <select id="b_dest_type"><option value="local">Local (this HA)</option><option value="mount">Mount (SMB/NFS)</option></select>
      </div>
      <div class="field"><label>Dest. mount name</label><input id="b_dest_mount" placeholder="NAS1"></div>
    </div>
    <div class="grid-3">
      <div class="field"><label>Source path / device</label><input id="b_src" value="/" placeholder="/path or /dev/sdX"></div>
      <div class="field"><label>&nbsp;</label>
        <div class="actions">
          <button id="btn_browse_ssh" class="secondary">Browse (SSH)</button>
          <button id="btn_browse_local" class="secondary">Pick local</button>
          <button id="btn_browse_mount" class="secondary">Pick from mount</button>
          <button id="btn_test_ssh" class="secondary">Test SSH</button>
        </div>
      </div>
      <div class="field"><label>&nbsp;</label><button id="btn_estimate" class="secondary">Estimate size</button></div>
    </div>
    <div class="actions">
      <button id="btn_start" class="primary">Start</button>
      <button id="btn_cancel" class="danger">Cancel Job</button>
    </div>
    <div class="progress-row">
      <label>Progress:</label><progress id="b_progress" value="0" max="100"></progress><span id="b_pct">0%</span>
    </div>
    <pre class="log" id="log"></pre>
  </div>
</section>

<section id="connections" class="panel hidden">
  <div class="card"><h2>Connections</h2>
    <div class="grid-4">
      <div class="field"><label>Name</label><input id="c_name"></div>
      <div class="field"><label>Host</label><input id="c_host"></div>
      <div class="field"><label>Port</label><input id="c_port" type="number" value="22"></div>
      <div class="field"><label>User</label><input id="c_user" value="root"></div>
      <div class="field"><label>Password</label><input id="c_pass" type="password"></div>
    </div>
    <div class="actions">
      <button id="c_save" class="primary">Save</button><button id="c_test" class="secondary">Test</button>
    </div>
    <table class="table" id="c_table"><thead><tr><th>Name</th><th>Host</th><th>Port</th><th>User</th></tr></thead><tbody></tbody></table>
  </div>
</section>

<section id="mounts" class="panel hidden">
  <div class="card"><h2>Mounts</h2>
    <div class="grid-4">
      <div class="field"><label>Name</label><input id="m_name"></div>
      <div class="field"><label>Type</label><select id="m_type"><option value="smb">SMB</option><option value="nfs">NFS</option></select></div>
      <div class="field"><label>Host</label><input id="m_host"></div>
      <div class="field"><label>Share/Export</label><input id="m_share"></div>
      <div class="field"><label>User</label><input id="m_user"></div>
      <div class="field"><label>Password</label><input id="m_pass" type="password"></div>
      <div class="field"><label>Options</label><input id="m_opts" placeholder="e.g. ro,vers=3"></div>
      <div class="field"><label>Auto-retry</label><select id="m_retry"><option value="1">Yes</option><option value="0">No</option></select></div>
    </div>
    <div class="actions">
      <button id="m_test" class="secondary">Test</button>
      <button id="m_save" class="primary">Save</button>
      <button id="m_mount" class="secondary">Mount</button>
      <button id="m_unmount" class="secondary">Unmount</button>
    </div>
    <table class="table" id="m_table"><thead><tr><th>Name</th><th>Type</th><th>Host</th><th>Share</th><th>Status</th><th>Mountpoint</th></tr></thead><tbody></tbody></table>
  </div>
</section>

<section id="backups" class="panel hidden">
  <div class="card"><h2>Backups</h2>
    <table class="table" id="bk_table"><thead><tr><th>Label</th><th>Size</th><th>Location</th><th>Actions</th></tr></thead><tbody></tbody></table>
  </div>
</section>

<section id="notifications" class="panel hidden">
  <div class="card"><h2>Notifications</h2>
    <div class="grid-4">
      <div class="field"><label>Gotify URL</label><input id="n_url"></div>
      <div class="field"><label>Token</label><input id="n_token"></div>
      <div class="field"><label>Priority</label><input id="n_priority" type="number" value="5"></div>
    </div>
    <div class="actions">
      <button id="n_save" class="primary">Save</button>
      <button id="n_test" class="secondary">Send test</button>
      <button id="sys_update" class="secondary">System apt update & upgrade (safe)</button>
    </div>
    <pre class="log" id="sys_log"></pre>
  </div>
</section>

<section id="help" class="panel hidden">
  <div class="card"><h2>Help</h2>
    <p><strong>Restore without this UI (disaster recovery):</strong></p>
    <ol>
      <li>SSH into Home Assistant host or any Linux box.</li>
      <li>Navigate to <code>/config/remote_linux_backup/backups/</code>.</li>
      <li>For rsync/copy backups: copy the folder back to the target using <code>rsync -a</code> or simple <code>cp -a</code>.</li>
      <li>For image backups (<code>.img.gz</code>): <code>gunzip -c disk.img.gz | sudo dd of=/dev/sdX bs=4M status=progress</code>.</li>
    </ol>
    <p><strong>Safety:</strong> image restore will overwrite the target disk; double-check device.</p>
  </div>
</section>
</main>

<script src="app.js"></script>
</body>
</html>
