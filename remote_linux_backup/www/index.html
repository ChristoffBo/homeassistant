<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Remote Linux Backup — Control Panel</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="header">
    <div class="brand">
      <img src="logo.png" alt="Logo" class="logo" />
      <h1>Remote Linux Backup</h1>
    </div>
    <nav class="tabs" role="tablist" aria-label="Sections">
      <button class="tab active" data-tab="backup">Backup</button>
      <button class="tab" data-tab="restore">Restore</button>
      <button class="tab" data-tab="settings">Settings</button>
      <button class="tab" data-tab="logs">Logs</button>
    </nav>
  </header>

  <main>
    <!-- BACKUP TAB -->
    <section class="tab-panel active" id="backup" role="tabpanel">
      <h2>Create a Backup</h2>
      <p class="help">Fill in where to back up <strong>from</strong> and <strong>to</strong>. Use "Known Hosts" for quick fill.</p>

      <div class="grid two">
        <div class="card">
          <h3>Source (server to back up from)</h3>
          <div class="field">
            <label for="known_src_select">Quick fill from Known Hosts</label>
            <select id="known_src_select">
              <option value="">— Select —</option>
            </select>
            <small>Select a saved host to auto-fill Source fields.</small>
          </div>
          <div class="field">
            <label for="src_host">Host or IP</label>
            <input id="src_host" placeholder="e.g. 10.0.0.5" autocomplete="host" />
            <small>The source Linux machine you want to back up.</small>
          </div>
          <div class="grid two inner">
            <div class="field">
              <label for="src_user">SSH Username</label>
              <input id="src_user" placeholder="e.g. root" autocomplete="username" />
              <small>User with read access to paths you back up.</small>
            </div>
            <div class="field">
              <label for="src_pass">SSH Password</label>
              <input id="src_pass" type="password" placeholder="••••••••" autocomplete="current-password" />
              <small>Password for SSH. Key auth not yet in UI.</small>
            </div>
          </div>
          <div class="field">
            <label for="src_path">Path to back up</label>
            <input id="src_path" placeholder="/var/lib/app/ or / (root) for full image via dd" />
            <small>Enter a folder for rsync backups or a block device (e.g. /dev/sda) for full image (dd).</small>
          </div>
        </div>

        <div class="card">
          <h3>Destination (where to store the backup)</h3>
          <div class="field">
            <label for="dst_type">Destination Type</label>
            <select id="dst_type">
              <option value="local">Local/NAS path</option>
              <option value="dropbox">Dropbox (rclone remote)</option>
            </select>
            <small>Choose where to store the backup.</small>
          </div>

          <div id="dst_local_group">
            <div class="field">
              <label for="dst_local_path">Local/NAS Path</label>
              <input id="dst_local_path" placeholder="/mnt/nas/backups/server1/" />
              <small>Mounted path visible to this add-on, e.g. /mnt/nas/…</small>
            </div>
          </div>

          <div id="dst_dropbox_group" class="hidden">
            <div class="field">
              <label for="dst_dropbox_path">Dropbox Path</label>
              <input id="dst_dropbox_path" placeholder="dropbox:/HA-Backups/Server1" />
              <small>Use your configured rclone remote. Example: <code>dropbox:/HA-Backups/Server1</code>.</small>
            </div>
          </div>

          <div class="grid two inner">
            <div class="field">
              <label for="job_interval">Run automatically</label>
              <select id="job_interval">
                <option value="disabled">Disabled (run once)</option>
                <option value="6h">Every 6 hours</option>
                <option value="12h">Every 12 hours</option>
                <option value="1d">Daily</option>
                <option value="7d">Weekly</option>
              </select>
              <small>Interval for automatic backups. Use Settings to adjust scheduler defaults.</small>
            </div>
            <div class="field">
              <label for="compression">Compression</label>
              <select id="compression">
                <option value="none">None (fastest)</option>
                <option value="gzip">gzip (.tar.gz)</option>
                <option value="zstd">zstd (.tar.zst)</option>
              </select>
              <small>Compression reduces size; increases CPU usage and time.</small>
            </div>
          </div>

          <div class="field">
            <label for="backup_name">Backup Name</label>
            <input id="backup_name" placeholder="Optional label (defaults to hostname+timestamp)" />
          </div>

          <div class="actions">
            <button id="btn_start_backup">Start Backup</button>
            <button id="btn_dry_run" class="ghost">Dry Run</button>
          </div>
        </div>
      </div>
    </section>

    <!-- RESTORE TAB -->
    <section class="tab-panel" id="restore" role="tabpanel">
      <h2>Restore a Backup</h2>
      <p class="help">Choose the <strong>target server to restore to</strong> and the <strong>backup location to restore from</strong>.</p>

      <div class="grid two">
        <div class="card">
          <h3>Target (server to restore to)</h3>
          <div class="field">
            <label for="known_rst_select">Quick fill from Known Hosts</label>
            <select id="known_rst_select">
              <option value="">— Select —</option>
            </select>
            <small>Select a saved host to auto-fill Target fields.</small>
          </div>
          <div class="field">
            <label for="rst_host">Host or IP</label>
            <input id="rst_host" placeholder="e.g. 10.0.0.6" />
            <small>Linux machine where data/disk will be restored.</small>
          </div>
          <div class="grid two inner">
            <div class="field">
              <label for="rst_user">SSH Username</label>
              <input id="rst_user" placeholder="e.g. root" />
            </div>
            <div class="field">
              <label for="rst_pass">SSH Password</label>
              <input id="rst_pass" type="password" placeholder="••••••••" />
            </div>
          </div>
          <div class="field">
            <label for="rst_target_path">Restore target path or block device</label>
            <input id="rst_target_path" placeholder="/var/lib/app/ or /dev/sdb for full image" />
            <small>For rsync, choose a folder. For full disk restore, select the block device.</small>
          </div>
        </div>

        <div class="card">
          <h3>Backup Source (where to restore from)</h3>
          <div class="field">
            <label for="rst_source_type">Source Type</label>
            <select id="rst_source_type">
              <option value="local">Local/NAS path</option>
              <option value="dropbox">Dropbox (rclone remote)</option>
            </select>
          </div>

          <div id="rst_local_group">
            <div class="field">
              <label for="rst_local_path">Local/NAS Path</label>
              <input id="rst_local_path" placeholder="/mnt/nas/backups/server1/2025-08-01/" />
            </div>
          </div>

          <div id="rst_dropbox_group" class="hidden">
            <div class="field">
              <label for="rst_dropbox_path">Dropbox Path</label>
              <input id="rst_dropbox_path" placeholder="dropbox:/HA-Backups/Server1/2025-08-01" />
            </div>
          </div>

          <div class="field">
            <label for="rst_mode">Restore Mode</label>
            <select id="rst_mode">
              <option value="rsync">Rsync (files/folders)</option>
              <option value="dd">Full Disk Image (dd)</option>
            </select>
            <small>Choose how to restore: files via rsync or full disk image via dd.</small>
          </div>

          <div class="actions">
            <button id="btn_list_backups" class="ghost">List Backups</button>
            <button id="btn_start_restore">Start Restore</button>
          </div>
        </div>
      </div>
    </section>

    <!-- SETTINGS TAB -->
    <section class="tab-panel" id="settings" role="tabpanel">
      <h2>Global Settings</h2>

      <div class="grid two">
        <div class="card">
          <h3>Scheduler Defaults</h3>
          <div class="grid two inner">
            <div class="field">
              <label for="default_interval">Default Interval</label>
              <select id="default_interval">
                <option value="6h">Every 6 hours</option>
                <option value="12h">Every 12 hours</option>
                <option value="1d">Daily</option>
                <option value="7d" selected>Weekly</option>
              </select>
              <small>Used when a job doesn’t specify an interval.</small>
            </div>
            <div class="field">
              <label for="auto_check">Auto Check Remote Storage</label>
              <select id="auto_check">
                <option value="enabled">Enabled</option>
                <option value="disabled" selected>Disabled</option>
              </select>
              <small>When enabled, the UI will periodically verify access to storage paths.</small>
            </div>
          </div>
        </div>

        <div class="card">
          <h3>Dropbox / rclone</h3>
          <div class="field">
            <label for="rclone_remote">Configured rclone remote name</label>
            <input id="rclone_remote" placeholder="dropbox" />
            <small>Set up rclone in the add-on container. Use this remote name with paths like <code>dropbox:/HA-Backups</code>.</small>
          </div>
          <div class="field">
            <label for="rclone_help">Where to get credentials?</label>
            <details id="rclone_help">
              <summary>Show rclone setup help</summary>
              <ol>
                <li>Install rclone and run <code>rclone config</code> inside the add-on shell.</li>
                <li>Create a remote named <code>dropbox</code> and complete the OAuth flow.</li>
                <li>Use paths in this UI like <code>dropbox:/HA-Backups/Server1</code>.</li>
              </ol>
            </details>
          </div>
        </div>
      </div>

      <div class="card">
        <h3>Known Hosts</h3>
        <div class="grid two inner">
          <div class="field">
            <label for="kh_label">Label (friendly name)</label>
            <input id="kh_label" placeholder="e.g. Proxmox-1" />
          </div>
          <div class="field">
            <label for="kh_host">Host or IP</label>
            <input id="kh_host" placeholder="10.0.0.5" />
          </div>
        </div>
        <div class="grid two inner">
          <div class="field">
            <label for="kh_user">SSH User</label>
            <input id="kh_user" placeholder="root" />
          </div>
          <div class="field">
            <label for="kh_path">Default Path</label>
            <input id="kh_path" placeholder="/var/lib/app/" />
          </div>
        </div>
        <div class="actions">
          <button id="kh_add">Add / Update</button>
          <button id="kh_clear" class="ghost">Clear Form</button>
        </div>
        <div class="table-wrap">
          <table class="table" id="kh_table" aria-label="Known hosts">
            <thead>
              <tr><th>Label</th><th>Host</th><th>User</th><th>Path</th><th>Actions</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <small>Known hosts are saved to add-on settings. Use the actions to apply to Backup/Restore.</small>
      </div>

      <div class="card">
        <h3>Presets (used to pre-fill forms)</h3>
        <div class="grid two inner">
          <div class="field">
            <label for="preset_src_host">Default Source Host</label>
            <input id="preset_src_host" placeholder="10.0.0.5" />
          </div>
          <div class="field">
            <label for="preset_src_user">Default Source User</label>
            <input id="preset_src_user" placeholder="root" />
          </div>
        </div>
        <div class="grid two inner">
          <div class="field">
            <label for="preset_src_path">Default Source Path</label>
            <input id="preset_src_path" placeholder="/var/lib/app/" />
          </div>
          <div class="field">
            <label for="preset_dst_local">Default Local/NAS Path</label>
            <input id="preset_dst_local" placeholder="/mnt/nas/backups/" />
          </div>
        </div>
        <div class="grid two inner">
          <div class="field">
            <label for="preset_dst_dropbox">Default Dropbox Path</label>
            <input id="preset_dst_dropbox" placeholder="dropbox:/HA-Backups/Server1" />
          </div>
          <div class="field">
            <label for="preset_interval">Default Job Interval</label>
            <select id="preset_interval">
              <option value="disabled">Disabled</option>
              <option value="6h">6h</option>
              <option value="12h">12h</option>
              <option value="1d">1d</option>
              <option value="7d">7d</option>
            </select>
          </div>
        </div>

        <div class="actions">
          <button id="btn_apply_presets" class="ghost">Apply to Forms</button>
          <button id="btn_save_settings">Save Settings</button>
        </div>
        <small>Saving writes to the add-on settings via backend API. Applies without restarting.</small>
      </div>
    </section>

    <!-- LOGS TAB -->
    <section class="tab-panel" id="logs" role="tabpanel">
      <h2>Activity & Logs</h2>
      <div class="card">
        <div class="actions">
          <button id="btn_refresh_logs" class="ghost">Refresh</button>
          <button id="btn_download_logs">Download</button>
        </div>
        <pre id="log_output" class="log"></pre>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span id="status_led" class="led led-idle" aria-live="polite">Idle</span>
    <span class="sep">•</span>
    <span id="status_text">Ready</span>
  </footer>

  <script src="app.js"></script>
</body>
</html>