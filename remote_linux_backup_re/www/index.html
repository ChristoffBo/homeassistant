<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Remote Linux Backup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { background:#0b1520; color:#e5f0ff; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; }
    .card { background:#0f1c2a; border:1px solid #213246; border-radius:14px; padding:16px; margin:16px auto; max-width:1100px; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:18px; }
    label { display:block; opacity:.9; margin-bottom:6px; }
    input, select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2a3d53; background:#0b1520; color:#e5f0ff; }
    textarea { min-height:120px; }
    .btn { background:#0ea5e9; color:#002338; border:0; padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer; }
    .btn.secondary { background:#1f2f44; color:#cfe8ff; }
    .btn.warn { background:#e11d48; color:#fff; }
    .tabs { display:flex; gap:8px; margin:16px auto; max-width:1100px; }
    .tab { padding:8px 12px; border-radius:10px; background:#0f1c2a; border:1px solid #213246; cursor:pointer; }
    .tab.active { background:#0ea5e9; color:#002338; border-color:#0ea5e9; font-weight:700; }
    .muted { color:#9fb6cc; font-size:13px; }
    table { width:100%; border-collapse:collapse; }
    th, td { border-bottom:1px solid #213246; padding:8px; text-align:left; vertical-align:middle; }
    tr:hover { background:#0b1724; }
    .flex { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active" data-target="tab-backup">Backup</div>
    <div class="tab" data-target="tab-restore">Restore</div>
    <div class="tab" data-target="tab-backups">Backups</div>
    <div class="tab" data-target="tab-mounts">Mounts</div>
    <div class="tab" data-target="tab-servers">Servers</div>
    <div class="tab" data-target="tab-settings">Settings</div>
    <div class="tab" data-target="tab-help">Help</div>
  </div>

  <!-- BACKUP -->
  <div id="tab-backup" class="card">
    <h3 style="margin:0 0 10px 0;">Source server</h3>
    <div class="row">
      <div><label>Server preset</label><select id="b_server"></select></div>
      <div><label>Backup name</label><input id="b_name" placeholder="proxmox-node1"></div>
      <div><label>Host/IP</label><input id="b_host" placeholder="10.0.0.21"></div>
      <div><label>User</label><input id="b_user" value="root"></div>
      <div><label>Password</label><input id="b_pass" type="password"></div>
      <div><label>Port</label><input id="b_port" value="22"></div>
      <div><label>Method</label>
        <select id="b_method">
          <option value="dd">Full Disk (dd)</option>
          <option value="rsync">Files (rsync)</option>
          <option value="zfs">ZFS snapshot</option>
        </select>
      </div>
      <div><label>Disk device <span class="muted">dd only (e.g. /dev/sda)</span></label><input id="b_disk" value="/dev/sda"></div>
    </div>

    <h3 style="margin:24px 0 10px 0;">Destination (store to)</h3>
    <div class="row">
      <div><label>Store to</label><select id="b_store"></select></div>
      <div><label>Status</label><div id="b_store_status" class="muted">—</div></div>
      <div class="flex" style="align-items:flex-end;">
        <button class="btn secondary" id="btn_store_mount">Mount now</button>
        <button class="btn secondary" id="btn_store_unmount">Unmount</button>
      </div>
      <div><label>Dropbox remote</label><input id="b_cloud" placeholder="dropbox:HA-Backups"></div>
      <div><label>Exclude patterns <span class="muted">rsync only</span></label><input id="b_excl" placeholder="*.iso,*.img"></div>
      <div><label>Bandwidth limit (KB/s) <span class="muted">0=unlimited</span></label><input id="b_bw" value="0"></div>
      <div><label>Retention (days)</label><input id="b_ret" value="0"></div>
      <div><label><input type="checkbox" id="b_verify"> Verify image checksum (dd)</label></div>
      <div><label><input type="checkbox" id="b_save_pw"> Save password in preset</label></div>
    </div>

    <div class="flex" style="margin-top:14px;">
      <button class="btn secondary" id="btn_probe">Probe host</button>
      <button class="btn secondary" id="btn_install">Auto-install tools</button>
      <button class="btn secondary" id="btn_estimate">Estimate time</button>
      <button class="btn" id="btn_run_backup">Run backup</button>
    </div>
    <div style="margin-top:14px;"><label>Result</label><textarea id="b_result" readonly></textarea></div>
  </div>

  <!-- RESTORE -->
  <div id="tab-restore" class="card" style="display:none;">
    <h3 style="margin:0 0 10px 0;">Restore target server</h3>
    <div class="row">
      <div><label>Server preset</label><select id="r_server"></select></div>
      <div><label>Host/IP</label><input id="r_host"></div>
      <div><label>User</label><input id="r_user" value="root"></div>
      <div><label>Password</label><input id="r_pass" type="password"></div>
      <div><label>Port</label><input id="r_port" value="22"></div>
      <div><label>Method</label><select id="r_method"><option value="dd">Restore Disk (dd)</option><option value="rsync">Restore Files (rsync)</option></select></div>
      <div><label>Image path (.img.gz)</label><div class="flex"><input id="r_image"><button class="btn secondary" id="btn_browse_image">Browse</button></div></div>
      <div><label>Disk device</label><input id="r_disk" value="/dev/sda"></div>
      <div><label>Exclude patterns</label><input id="r_excl"></div>
      <div><label>Bandwidth limit (KB/s)</label><input id="r_bw" value="0"></div>
      <div><label>Local source (rsync)</label><input id="r_local_src" placeholder="/backup/etc/"></div>
      <div><label>Remote destination</label><input id="r_remote_dest" placeholder="/"></div>
    </div>
    <div class="flex" style="margin-top:14px;"><button class="btn" id="btn_run_restore">Run restore</button></div>
    <div style="margin-top:14px;"><label>Result</label><textarea id="r_result" readonly></textarea></div>
  </div>

  <!-- BACKUPS -->
  <div id="tab-backups" class="card" style="display:none;">
    <div class="flex" style="margin-bottom:10px;">
      <button class="btn" id="btn_backups_refresh">Refresh</button>
      <button class="btn secondary" id="btn_backups_rescan">Full rescan</button>
    </div>
    <div style="overflow:auto;">
      <table><thead><tr><th>Path</th><th>Kind</th><th>Host</th><th>Size</th><th>Created</th><th>Action</th></tr></thead><tbody id="backups_rows"></tbody></table>
    </div>
  </div>

  <!-- MOUNTS -->
  <div id="tab-mounts" class="card" style="display:none;">
    <p class="muted">Add NAS mounts (SMB/CIFS or NFS). They appear in the “Store to” dropdown. Tick <b>Auto-mount</b> for startup.</p>
    <div class="row">
      <div><label>Preset name</label><input id="m_name" placeholder="NAS_Backups"></div>
      <div><label>Protocol</label>
        <select id="m_proto"><option value="cifs">SMB / CIFS</option><option value="nfs">NFS</option></select>
      </div>
      <div><label>Server / host</label><input id="m_server" placeholder="192.168.1.10"></div>
      <div><label>Share / export</label><input id="m_share" placeholder="Backups  (SMB)   or   /export/backups  (NFS)"></div>
      <div><label>Username (SMB)</label><input id="m_user" placeholder="leave empty for NFS"></div>
      <div><label>Password (SMB)</label><input id="m_pass" type="password"></div>
      <div><label>Mount point</label><input id="m_mount" placeholder="/mnt/NAS_Backups"></div>
      <div><label>Options (advanced)</label><input id="m_opts" placeholder="e.g. vers=3.1.1"></div>
      <div><label><input type="checkbox" id="m_auto"> Auto-mount on start</label></div>
    </div>
    <div class="flex" style="margin-top:10px;">
      <button class="btn" id="btn_add_mount">Add / Update</button>
      <button class="btn secondary" id="btn_save_mounts">Save all</button>
      <button class="btn secondary" id="btn_refresh_mounts">Refresh status</button>
    </div>
    <div style="overflow:auto; margin-top:10px;">
      <table>
        <thead><tr><th>Name</th><th>Proto</th><th>Server/share</th><th>Mount</th><th>Auto</th><th>Status</th><th>Actions</th></tr></thead>
        <tbody id="mount_rows"></tbody>
      </table>
    </div>
    <textarea id="mounts_json_hidden" style="display:none;"></textarea>
  </div>

  <!-- SERVERS -->
  <div id="tab-servers" class="card" style="display:none;">
    <p class="muted">Saved servers (host/user/port). Select on Backup/Restore via “Server preset”.</p>
    <div class="flex" style="margin-bottom:10px;">
      <button class="btn" id="btn_add_server_from_backup">Save current Backup form as preset</button>
      <button class="btn secondary" id="btn_refresh_servers">Reload</button>
    </div>
    <div style="overflow:auto;">
      <table>
        <thead><tr><th>Name</th><th>Host</th><th>User</th><th>Port</th><th>Password saved</th><th>Actions</th></tr></thead>
        <tbody id="servers_rows"></tbody>
      </table>
    </div>
  </div>

  <!-- SETTINGS -->
  <div id="tab-settings" class="card" style="display:none;">
    <div class="row">
      <div><label>UI Port (read-only)</label><input id="s_ui_port" disabled></div>
      <div><label>Gotify URL</label><input id="s_gotify_url" placeholder="http://host:port"></div>
      <div><label>Gotify Token</label><input id="s_gotify_token"></div>
      <div><label>Dropbox enabled</label><select id="s_dropbox_enabled"><option value="false">false</option><option value="true">true</option></select></div>
      <div><label>Dropbox remote</label><input id="s_dropbox_remote" placeholder="dropbox:HA-Backups"></div>
    </div>
    <div class="flex" style="margin-top:10px;">
      <button class="btn" id="btn_save_settings">Save settings</button>
      <button class="btn secondary" id="btn_test_gotify">Test Gotify</button>
      <button class="btn secondary" id="btn_test_dropbox">Test Dropbox</button>
    </div>
    <p class="muted" id="dropbox_hint"></p>
    <div style="margin-top:14px;"><label>Status</label><textarea id="s_status" readonly></textarea></div>
  </div>

  <!-- HELP -->
  <div id="tab-help" class="card" style="display:none;">
    <h3>Where are my backups?</h3>
    <p>/backup by default or any mounted path under /mnt (see “Mounts”). You can see them in the “Backups” tab or “Restore → Browse”.</p>
    <h3>Full disk vs files</h3>
    <ul>
      <li><b>dd</b> backs up the whole disk (e.g. /dev/sda) to <code>.img.gz</code>. Restore from a Linux live USB: <code>gzip -dc image.img.gz | dd of=/dev/sdX bs=64K status=progress</code>.</li>
      <li><b>rsync</b> copies a directory tree; restore by rsync back or pick individual files.</li>
    </ul>
    <h3>Dropbox setup</h3>
    <ol>
      <li>Use HA Terminal to create <code>/config/rclone.conf</code> with <code>rclone config</code>.</li>
      <li>Set “Dropbox remote” here, then “Test Dropbox”.</li>
    </ol>
  </div>

  <script src="/www/app.js"></script>
</body>
</html>
