<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Remote Linux Backup</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="wrap">
    <header class="hero">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>Remote Linux Backup</h1>
          <p class="sub">Simple backups &amp; mounts</p>
        </div>
      </div>
      <nav class="tabs">
        <button data-tab="backup" class="tab is-active">Backup</button>
        <button data-tab="restore" class="tab">Restore</button>
        <button data-tab="mounts" class="tab">Mounts</button>
        <button data-tab="backups" class="tab">Backups</button>
        <button data-tab="settings" class="tab">Settings</button>
        <button data-tab="help" class="tab">Help</button>
      </nav>
      <div class="alpha">Alpha software. Use at your own risk. Restores can destroy data. Always have verified backups.</div>
    </header>

    <!-- Backup -->
    <section id="panel-backup" class="panel is-active">
      <form class="grid">
        <div class="field">
          <label>Host/IP</label>
          <input id="b_host" placeholder="10.0.0.10">
        </div>
        <div class="field">
          <label>User</label>
          <input id="b_user" value="root">
        </div>
        <div class="field">
          <label>Port</label>
          <input id="b_port" value="22">
        </div>
        <div class="field">
          <label>Password</label>
          <input id="b_pass" type="password">
        </div>

        <div class="field">
          <label>Method</label>
          <select id="b_method">
            <option value="dd">Full Disk (dd)</option>
            <option value="rsync">Files (rsync)</option>
            <option value="zfs">ZFS snapshot</option>
          </select>
        </div>
        <div class="field">
          <label>Disk device (dd)</label>
          <input id="b_disk" value="/dev/sda">
        </div>
        <div class="field">
          <label>Store to (local folder or mounted share)</label>
          <select id="b_store"></select>
          <div class="tiny muted">Use Mounts tab to add NAS shares. “/backup” is always available locally.</div>
        </div>
        <div class="field">
          <label>Backup name (label)</label>
          <input id="b_name" placeholder="OPNsense-01">
        </div>

        <div class="field">
          <label>Files (rsync, comma separated)</label>
          <input id="b_files" value="/etc,/home">
        </div>
        <div class="field">
          <label>Excludes (rsync, comma separated)</label>
          <input id="b_excludes" placeholder="*.tmp,*.cache">
        </div>
        <div class="field">
          <label>Bandwidth limit (KB/s)</label>
          <input id="b_bw" value="">
        </div>
        <div class="field">
          <label>Verify (dd)</label>
          <select id="b_verify">
            <option value="false">No</option>
            <option value="true">Yes</option>
          </select>
        </div>

        <div class="field">
          <label>Retention days (prune old)</label>
          <input id="b_retention" value="">
        </div>
        <div class="field">
          <label>Cloud upload (rclone remote:path)</label>
          <input id="b_cloud" placeholder="dropbox:HA-Backups">
        </div>
      </form>

      <div class="actions">
        <button id="btnEstimate" class="btn">Estimate</button>
        <button id="btnBackup" class="btn primary">Run backup</button>
      </div>
    </section>

    <!-- Restore -->
    <section id="panel-restore" class="panel">
      <form class="grid">
        <div class="field">
          <label>Host/IP</label>
          <input id="r_host" placeholder="10.0.0.10">
        </div>
        <div class="field">
          <label>User</label>
          <input id="r_user" value="root">
        </div>
        <div class="field">
          <label>Port</label>
          <input id="r_port" value="22">
        </div>
        <div class="field">
          <label>Password</label>
          <input id="r_pass" type="password">
        </div>

        <div class="field">
          <label>Method</label>
          <select id="r_method">
            <option value="dd">Full Disk (dd)</option>
            <option value="rsync">Files (rsync)</option>
          </select>
        </div>
        <div class="field">
          <label>Disk device (dd)</label>
          <input id="r_disk" value="/dev/sda">
        </div>
        <div class="field wide">
          <label>Image path (dd) or local source (rsync)</label>
          <input id="r_src" placeholder="/backup/myhost-2025-01-01.img.gz">
          <div class="tiny muted">
            Tip: use Backups tab to pick a file (Restore button there asks twice before running).
          </div>
        </div>
        <div class="field">
          <label>Remote dest (rsync)</label>
          <input id="r_dest" value="/">
        </div>
        <div class="field">
          <label>Excludes (rsync)</label>
          <input id="r_ex" placeholder="*.tmp,*.cache">
        </div>
        <div class="field">
          <label>Bandwidth limit (KB/s)</label>
          <input id="r_bw" value="">
        </div>
      </form>

      <div class="actions">
        <button id="btnRestore" class="btn danger">Run restore</button>
      </div>
    </section>

    <!-- Mounts -->
    <section id="panel-mounts" class="panel">
      <form class="grid">
        <div class="field">
          <label>Preset name</label>
          <input id="m_name" placeholder="NAS-Backups">
        </div>
        <div class="field">
          <label>Protocol</label>
          <select id="m_proto">
            <option value="cifs">SMB/CIFS</option>
            <option value="nfs">NFS</option>
          </select>
        </div>
        <div class="field">
          <label>Server / host</label>
          <input id="m_server" placeholder="10.0.0.21">
        </div>

        <div class="field">
          <label>Username (SMB)</label>
          <input id="m_user" placeholder="user">
        </div>
        <div class="field">
          <label>Password (SMB)</label>
          <input id="m_pass" type="password" placeholder="pass">
        </div>
        <div class="field">
          <label>Share (SMB) / Export (NFS)</label>

          <div class="share-picker">
            <input id="m_share" placeholder="Backups  OR  /export/backups">
            <select id="m_share_list" class="inline"></select>
          </div>
          <div class="tiny muted">Click “List shares/exports” to populate the dropdown.</div>
        </div>

        <div class="field">
          <label>Mount point</label>
          <input id="m_mount" value="/mnt/Backups">
        </div>
        <div class="field">
          <label>Extra options</label>
          <input id="m_opts" placeholder="iocharset=utf8,uid=0,gid=0">
        </div>
        <div class="field">
          <label>Auto-mount on start</label>
          <select id="m_auto">
            <option value="false">No</option>
            <option value="true">Yes</option>
          </select>
        </div>
      </form>

      <div class="actions">
        <button id="btnList" class="btn">List shares/exports</button>
        <button id="btnBrowse" class="btn">Browse</button>
        <button id="btnAddMount" class="btn primary">Add / Update</button>
      </div>

      <h3>Mount presets</h3>
      <div class="table-wrap">
        <table id="mountTable" class="table">
          <thead>
            <tr>
              <th>Name</th><th>Proto</th><th>Server</th><th>Share/Export</th>
              <th>Mount</th><th>Auto</th><th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Backups -->
    <section id="panel-backups" class="panel">
      <div class="table-wrap">
        <table id="backupsTable" class="table">
          <thead>
            <tr>
              <th>Path</th><th>Type</th><th>Location</th><th>Size</th><th>Date</th><th>Actions</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- Settings -->
    <section id="panel-settings" class="panel">
      <form class="grid">
        <div class="field wide">
          <label>Gotify URL</label>
          <input id="s_gurl" placeholder="https://gotify.your.tld">
        </div>
        <div class="field wide">
          <label>Gotify token</label>
          <input id="s_gtoken" placeholder="App token">
        </div>
        <div class="field">
          <label>Enable Gotify</label>
          <select id="s_gen">
            <option value="false">No</option>
            <option value="true">Yes</option>
          </select>
        </div>

        <div class="field">
          <label>Enable Dropbox (rclone)</label>
          <select id="s_dben">
            <option value="false">No</option>
            <option value="true">Yes</option>
          </select>
        </div>
        <div class="field wide">
          <label>Dropbox remote</label>
          <input id="s_dropremote" value="dropbox:HA-Backups">
        </div>
        <div class="field">
          <label>UI Port</label>
          <input id="s_uiport" value="8066">
        </div>
      </form>

      <div class="actions">
        <button id="btnSaveSettings" class="btn primary">Save settings</button>
        <button id="btnTestGotify" class="btn">Test Gotify</button>
      </div>
    </section>

    <!-- Help -->
    <section id="panel-help" class="panel">
      <div class="help">
        <h3>Quick tips</h3>
        <ul>
          <li>Use <strong>Mounts</strong> to add your NAS share. Click <em>List shares/exports</em> then pick from the dropdown.</li>
          <li><strong>Backup</strong> → choose “Store to” (local /backup or a mounted share) and hit <em>Run backup</em>.</li>
          <li><strong>Backups</strong> lists all files it finds under /backup and any mounted points. Use <em>Restore</em> there to prefill Restore and confirm twice.</li>
          <li>Configure optional <strong>Gotify</strong> notifications on the Settings tab and <em>Test</em> them here first.</li>
        </ul>
      </div>
    </section>

    <!-- Output / status -->
    <section class="panel">
      <label class="muted">Status / Output</label>
      <textarea id="status_box" class="log" spellcheck="false"></textarea>
    </section>
  </main>

  <!-- Browse modal -->
  <div id="browse_modal" class="modal">
    <div class="modal-card">
      <h3>Browse</h3>
      <div id="browse_path" class="muted tiny"></div>
      <div id="browse_list" class="list"></div>
      <div class="actions right">
        <button id="browse_up" class="btn">Up</button>
        <button id="browse_close" class="btn">Close</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
