<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Remote Linux Backup</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { background:#0b1520; color:#e5f0ff; font-family: ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; }
    .card { background:#0f1c2a; border:1px solid #213246; border-radius:14px; padding:16px; margin:16px auto; max-width:1100px; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:18px; }
    label { display:block; opacity:.9; margin-bottom:6px; }
    input, select, textarea { width:100%; padding:10px 12px; border-radius:10px; border:1px solid #2a3d53; background:#0b1520; color:#e5f0ff; }
    textarea { min-height:120px; }
    .btn { background:#0ea5e9; color:#002338; border:0; padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer; }
    .btn.secondary { background:#1f2f44; color:#cfe8ff; }
    .tabs { display:flex; gap:8px; margin:16px auto; max-width:1100px; }
    .tab { padding:8px 12px; border-radius:10px; background:#0f1c2a; border:1px solid #213246; cursor:pointer; }
    .tab.active { background:#0ea5e9; color:#002338; border-color:#0ea5e9; font-weight:700; }
    .muted { color:#9fb6cc; font-size:13px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .help code { background:#0b1520; padding:2px 6px; border-radius:8px; border:1px solid #213246; }
    .help h3 { margin-top:22px; }
    .flex { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .crumbs { margin-bottom:10px; }
    .crumbs span { cursor:pointer; margin-right:6px; background:#0f1c2a; border:1px solid #213246; padding:4px 8px; border-radius:8px; }
    table { width:100%; border-collapse:collapse; }
    th, td { border-bottom:1px solid #213246; padding:8px; text-align:left; }
    tr:hover { background:#0b1724; }
  </style>
</head>
<body>
  <div class="tabs">
    <div class="tab active" data-target="tab-backup">Backup</div>
    <div class="tab" data-target="tab-restore">Restore</div>
    <div class="tab" data-target="tab-backups">Backups</div>
    <div class="tab" data-target="tab-explorer">Explorer</div>
    <div class="tab" data-target="tab-jobs">Jobs</div>
    <div class="tab" data-target="tab-settings">Settings</div>
    <div class="tab" data-target="tab-help">Help</div>
  </div>

  <!-- BACKUP -->
  <div id="tab-backup" class="card">
    <div class="row">
      <div><label>Host/IP <span class="muted">Remote server to back up</span></label><input id="b_host" placeholder="10.0.0.21"></div>
      <div><label>Backup name <span class="muted">Optional label</span></label><input id="b_name" placeholder="proxmox-node1"></div>
      <div><label>User</label><input id="b_user" value="root"></div>
      <div><label>Password</label><input id="b_pass" type="password"></div>
      <div><label>Port</label><input id="b_port" value="22"></div>
      <div><label>Method</label>
        <select id="b_method"><option value="dd">Full Disk (dd)</option><option value="rsync">Files (rsync)</option><option value="zfs">ZFS snapshot</option></select>
      </div>
      <div><label>Disk device <span class="muted">For dd, e.g. <span class="mono">/dev/sda</span></span></label><input id="b_disk" value="/dev/sda"></div>
      <div><label>Store to <span class="muted">Path inside add-on</span></label><input id="b_store" value="/backup"></div>
      <div><label>Dropbox remote</label><input id="b_cloud" placeholder="dropbox:HA-Backups"></div>
      <div><label>Exclude patterns <span class="muted">rsync only</span></label><input id="b_excl" placeholder="*.iso,*.img"></div>
      <div><label>Bandwidth limit (KB/s) <span class="muted">0=unlimited</span></label><input id="b_bw" value="0"></div>
      <div><label>Retention (days)</label><input id="b_ret" value="0"></div>
    </div>
    <div class="flex" style="margin-top:12px;"><label style="display:flex;align-items:center; gap:8px;"><input type="checkbox" id="b_verify"> Verify image checksum (dd)</label></div>
    <div class="flex" style="margin-top:14px;">
      <button class="btn secondary" id="btn_probe">Probe host</button>
      <button class="btn secondary" id="btn_install">Auto-install tools</button>
      <button class="btn secondary" id="btn_estimate">Estimate time</button>
      <button class="btn" id="btn_run_backup">Run backup</button>
    </div>
    <div style="margin-top:14px;"><label>Result</label><textarea id="b_result" readonly></textarea></div>
  </div>

  <!-- RESTORE -->
  <div id="tab-restore" class="card" style="display:none;">
    <div class="row">
      <div><label>Host/IP</label><input id="r_host" placeholder="10.0.0.21"></div>
      <div><label>User</label><input id="r_user" value="root"></div>
      <div><label>Password</label><input id="r_pass" type="password"></div>
      <div><label>Port</label><input id="r_port" value="22"></div>
      <div><label>Method</label><select id="r_method"><option value="dd">Restore Disk (dd)</option><option value="rsync">Restore Files (rsync)</option></select></div>
      <div><label>Image path (.img.gz)</label><input id="r_image"></div>
      <div><label>Disk device</label><input id="r_disk" value="/dev/sda"></div>
      <div><label>Exclude patterns</label><input id="r_excl"></div>
      <div><label>Bandwidth limit (KB/s)</label><input id="r_bw" value="0"></div>
      <div><label>Local source (rsync restore)</label><input id="r_local_src" placeholder="/backup/etc/"></div>
      <div><label>Remote destination (rsync restore)</label><input id="r_remote_dest" placeholder="/"></div>
    </div>
    <div class="flex" style="margin-top:14px;"><button class="btn" id="btn_run_restore">Run restore</button></div>
    <div style="margin-top:14px;"><label>Result</label><textarea id="r_result" readonly></textarea></div>
  </div>

  <!-- BACKUPS (persistent index) -->
  <div id="tab-backups" class="card" style="display:none;">
    <div class="flex" style="margin-bottom:10px;">
      <button class="btn" id="btn_backups_refresh">Refresh</button>
      <button class="btn secondary" id="btn_backups_rescan">Full rescan</button>
    </div>
    <div style="overflow:auto;">
      <table>
        <thead><tr><th>Path</th><th>Kind</th><th>Host</th><th>Size</th><th>Created</th><th>Action</th></tr></thead>
        <tbody id="backups_rows"></tbody>
      </table>
    </div>
  </div>

  <!-- EXPLORER -->
  <div id="tab-explorer" class="card" style="display:none;">
    <div class="flex crumbs" id="crumbs"></div>
    <div class="flex"><button class="btn secondary" id="jump_backup">/backup</button><button class="btn secondary" id="jump_mnt">/mnt</button></div>
    <div style="overflow:auto; margin-top:10px;">
      <table>
        <thead><tr><th>Name</th><th>Type</th><th>Size</th><th>Action</th></tr></thead>
        <tbody id="explorer_rows"></tbody>
      </table>
    </div>
  </div>

  <!-- JOBS -->
  <div id="tab-jobs" class="card" style="display:none;">
    <p class="muted">One job per line. Use JSON or simple <span class="mono">key=value;key=value</span>. Required: <span class="mono">host, username, password, method, schedule</span>.</p>
    <textarea id="jobs_text" placeholder='{"host":"10.0.0.21","username":"root","password":"***","method":"dd","schedule":"0 3 * * *"}'></textarea>
    <div class="flex" style="margin-top:14px;">
      <button class="btn" id="btn_save_jobs">Save jobs</button>
      <button class="btn secondary" id="btn_apply_schedule">Apply schedule</button>
    </div>
    <div style="margin-top:14px;"><label>Scheduler</label><textarea id="jobs_status" readonly></textarea></div>
  </div>

  <!-- SETTINGS -->
  <div id="tab-settings" class="card" style="display:none;">
    <div class="row">
      <div><label>UI Port <span class="muted">Non-Ingress (read-only)</span></label><input id="s_ui_port" disabled></div>
      <div><label>Gotify URL</label><input id="s_gotify_url" placeholder="http://host:port"></div>
      <div><label>Gotify Token</label><input id="s_gotify_token"></div>
      <div><label>Dropbox enabled</label><select id="s_dropbox_enabled"><option value="false">false</option><option value="true">true</option></select></div>
      <div><label>Dropbox remote</label><input id="s_dropbox_remote" placeholder="dropbox:HA-Backups"></div>
    </div>
    <div class="flex" style="margin-top:14px;"><button class="btn" id="btn_save_settings">Save settings</button><button class="btn secondary" id="btn_list_backups">List local backups</button></div>
    <div style="margin-top:14px;"><label>Status</label><textarea id="s_status" readonly></textarea></div>
  </div>

  <!-- HELP -->
  <div id="tab-help" class="card help" style="display:none;">
    <h3>Where are my backups?</h3>
    <p>Default: <code>/backup</code> (also shown in the <b>Explorer</b> tab and the <b>Backups</b> tab). On the HA host this is the standard <b>backup</b> share (via Samba add-on). Optional copy to Dropbox if configured.</p>
    <h3>Disk device (dd)</h3>
    <p>Whole disk, e.g. <code>/dev/sda</code> or <code>/dev/nvme0n1</code>. Backs up the entire system drive to a <code>.img.gz</code>.</p>
    <h3>Dead server restore</h3>
    <ol>
      <li>Boot Linux live USB.</li>
      <li>Get the image (from /backup, Explorer â†’ Download, or Dropbox).</li>
      <li>Run <code>gzip -dc image.img.gz | sudo dd of=/dev/sdX bs=64K status=progress</code>.</li>
      <li>Reboot from the restored disk.</li>
    </ol>
    <h3>Other tools</h3>
    <ul>
      <li>dd image: ungzip and write with <code>dd</code>, BalenaEtcher, etc.</li>
      <li>rsync backup: normal folder tree; copy files as needed.</li>
    </ul>
  </div>

  <script src="/www/app.js"></script>
</body>
</html>
